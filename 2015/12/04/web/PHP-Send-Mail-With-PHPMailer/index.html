<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ThinkPHP下使用PHPMailer发送邮件 | 麦子的博客</title><meta name="keywords" content="php"><meta name="author" content="pengweifu"><meta name="copyright" content="pengweifu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="ThinkPHP下使用PHPMailer发送邮件">
<meta property="og:type" content="article">
<meta property="og:title" content="ThinkPHP下使用PHPMailer发送邮件">
<meta property="og:url" content="https://www.pengwf.com/2015/12/04/web/PHP-Send-Mail-With-PHPMailer/index.html">
<meta property="og:site_name" content="麦子的博客">
<meta property="og:description" content="ThinkPHP下使用PHPMailer发送邮件">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.pengwf.com/images/mac/10.png">
<meta property="article:published_time" content="2015-12-03T16:00:00.000Z">
<meta property="article:modified_time" content="2015-12-03T16:00:00.000Z">
<meta property="article:author" content="pengweifu">
<meta property="article:tag" content="mail">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.pengwf.com/images/mac/10.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.pengwf.com/2015/12/04/web/PHP-Send-Mail-With-PHPMailer/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c52098f04c07f714298c1f4c0fabd5bc";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.4.0',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.bootcdn.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.bootcdn.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2015-12-04 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="麦子的博客" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/images/face.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">94</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">37</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 更多</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/Demos/bs/"><i class="fa-fw fa fa-chevron-right"></i><span> BootStrap</span></a></li><li><a class="site-page" href="/Demos/artdialog/"><i class="fa-fw fa fa-chevron-right"></i><span> Artdialog</span></a></li><li><a class="site-page" href="/Demos/haoanju/"><i class="fa-fw fa fa-chevron-right"></i><span> haoanju</span></a></li><li><a class="site-page" href="/Demos/threejs/"><i class="fa-fw fa fa-chevron-right"></i><span> threejs</span></a></li><li><a class="site-page" href="/Demos/canvas/"><i class="fa-fw fa fa-chevron-right"></i><span> canvas</span></a></li><li><a class="site-page" href="/Demos/cube/"><i class="fa-fw fa fa-chevron-right"></i><span> cube</span></a></li><li><a class="site-page" href="/Demos/vuejs/"><i class="fa-fw fa fa-chevron-right"></i><span> vuejs</span></a></li><li><a class="site-page" href="/Demos/rose.html"><i class="fa-fw fa fa-chevron-right"></i><span> rose</span></a></li><li><a class="site-page" href="/Demos/map/Amap.html"><i class="fa-fw fa fa-chevron-right"></i><span> Amap</span></a></li><li><a class="site-page" href="/Demos/map/BaidumapcustomresultpanelV1.4.html"><i class="fa-fw fa fa-chevron-right"></i><span> Baidumap V1.4</span></a></li><li><a class="site-page" href="/Demos/map/BaidumapcustomresultpanelV2.html"><i class="fa-fw fa fa-chevron-right"></i><span> Baidumap V2</span></a></li></ul></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">1.</span> <span class="toc-text">测试文件内容</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PHPMailer%E6%96%87%E4%BB%B6PHPMailer-class-php"><span class="toc-number">2.</span> <span class="toc-text">PHPMailer文件PHPMailer.class.php</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SMTP%E6%96%87%E4%BB%B6Smtp-class-php"><span class="toc-number">3.</span> <span class="toc-text">SMTP文件Smtp.class.php</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E7%B1%BBException-class-php"><span class="toc-number">4.</span> <span class="toc-text">异常类Exception.class.php</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://www.pengwf.com/images/mac/10.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">麦子的博客</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 更多</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/Demos/bs/"><i class="fa-fw fa fa-chevron-right"></i><span> BootStrap</span></a></li><li><a class="site-page" href="/Demos/artdialog/"><i class="fa-fw fa fa-chevron-right"></i><span> Artdialog</span></a></li><li><a class="site-page" href="/Demos/haoanju/"><i class="fa-fw fa fa-chevron-right"></i><span> haoanju</span></a></li><li><a class="site-page" href="/Demos/threejs/"><i class="fa-fw fa fa-chevron-right"></i><span> threejs</span></a></li><li><a class="site-page" href="/Demos/canvas/"><i class="fa-fw fa fa-chevron-right"></i><span> canvas</span></a></li><li><a class="site-page" href="/Demos/cube/"><i class="fa-fw fa fa-chevron-right"></i><span> cube</span></a></li><li><a class="site-page" href="/Demos/vuejs/"><i class="fa-fw fa fa-chevron-right"></i><span> vuejs</span></a></li><li><a class="site-page" href="/Demos/rose.html"><i class="fa-fw fa fa-chevron-right"></i><span> rose</span></a></li><li><a class="site-page" href="/Demos/map/Amap.html"><i class="fa-fw fa fa-chevron-right"></i><span> Amap</span></a></li><li><a class="site-page" href="/Demos/map/BaidumapcustomresultpanelV1.4.html"><i class="fa-fw fa fa-chevron-right"></i><span> Baidumap V1.4</span></a></li><li><a class="site-page" href="/Demos/map/BaidumapcustomresultpanelV2.html"><i class="fa-fw fa fa-chevron-right"></i><span> Baidumap V2</span></a></li></ul></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">ThinkPHP下使用PHPMailer发送邮件</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2015-12-03T16:00:00.000Z" title="发表于 2015-12-04 00:00:00">2015-12-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2015-12-03T16:00:00.000Z" title="更新于 2015-12-04 00:00:00">2015-12-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/PHP/">PHP</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><div class="layout_post main-content" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="测试文件内容"><a href="#测试文件内容" class="headerlink" title="测试文件内容"></a>测试文件内容</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(E_ALL);</span><br><span class="line">ini_set(&#x27;display_errors&#x27;,&#x27;On&#x27;);</span><br><span class="line">function sendMail($to, $title, $content) &#123;</span><br><span class="line">    include(&#x27;ThinkPHP/Library/Think/Exception.class.php&#x27;);</span><br><span class="line">    include(&#x27;ThinkPHP/Library/Org/Util/PHPMailer.class.php&#x27;);</span><br><span class="line">    $mail = new \Org\Util\PHPMailer(); //实例化</span><br><span class="line">    $mail-&gt;IsSMTP(); // 启用SMTP</span><br><span class="line">    $mail-&gt;Host=&#x27;smtp.qq.com&#x27;; //smtp服务器的名称（这里以QQ邮箱为例）</span><br><span class="line">    $mail-&gt;SMTPAuth = true; //启用smtp认证</span><br><span class="line">    $mail-&gt;Username = &#x27;710627107@qq.com&#x27;; //你的邮箱名</span><br><span class="line">    $mail-&gt;Password = &#x27;12345&#x27;; //邮箱密码</span><br><span class="line">    $mail-&gt;From = &#x27;710627107@qq.com&#x27;; //发件人地址（也就是你的邮箱地址）</span><br><span class="line">    $mail-&gt;FromName = &#x27;哒哒哒&#x27;; //发件人姓名</span><br><span class="line">    $mail-&gt;AddAddress($to,&quot;尊敬的客户&quot;);</span><br><span class="line">    $mail-&gt;WordWrap = 50; //设置每行字符长度</span><br><span class="line">    $mail-&gt;IsHTML(true); // 是否HTML格式邮件</span><br><span class="line">    $mail-&gt;CharSet=&#x27;utf-8&#x27;; //设置邮件编码</span><br><span class="line">    $mail-&gt;Subject =$title; //邮件主题</span><br><span class="line">    $mail-&gt;Body = $content; //邮件内容</span><br><span class="line">    $mail-&gt;AltBody = &quot;这是一个纯文本的身体在非营利的HTML电子邮件客户端&quot;; //邮件正文不支持HTML的备用显示</span><br><span class="line">    if ($mail-&gt;Send()) &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return &#x27;error:&#x27;.$mail-&gt;ErrorInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$r=sendMail(&#x27;weifupeng75@163.com&#x27;,&#x27;主题&#x27;,&#x27;内容&#x27;);</span><br><span class="line">if($r!==true) &#123;</span><br><span class="line">    echo $r;</span><br><span class="line">    echo phpinfo();</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="PHPMailer文件PHPMailer-class-php"><a href="#PHPMailer文件PHPMailer-class-php" class="headerlink" title="PHPMailer文件PHPMailer.class.php"></a>PHPMailer文件PHPMailer.class.php</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br><span class="line">1865</span><br><span class="line">1866</span><br><span class="line">1867</span><br><span class="line">1868</span><br><span class="line">1869</span><br><span class="line">1870</span><br><span class="line">1871</span><br><span class="line">1872</span><br><span class="line">1873</span><br><span class="line">1874</span><br><span class="line">1875</span><br><span class="line">1876</span><br><span class="line">1877</span><br><span class="line">1878</span><br><span class="line">1879</span><br><span class="line">1880</span><br><span class="line">1881</span><br><span class="line">1882</span><br><span class="line">1883</span><br><span class="line">1884</span><br><span class="line">1885</span><br><span class="line">1886</span><br><span class="line">1887</span><br><span class="line">1888</span><br><span class="line">1889</span><br><span class="line">1890</span><br><span class="line">1891</span><br><span class="line">1892</span><br><span class="line">1893</span><br><span class="line">1894</span><br><span class="line">1895</span><br><span class="line">1896</span><br><span class="line">1897</span><br><span class="line">1898</span><br><span class="line">1899</span><br><span class="line">1900</span><br><span class="line">1901</span><br><span class="line">1902</span><br><span class="line">1903</span><br><span class="line">1904</span><br><span class="line">1905</span><br><span class="line">1906</span><br><span class="line">1907</span><br><span class="line">1908</span><br><span class="line">1909</span><br><span class="line">1910</span><br><span class="line">1911</span><br><span class="line">1912</span><br><span class="line">1913</span><br><span class="line">1914</span><br><span class="line">1915</span><br><span class="line">1916</span><br><span class="line">1917</span><br><span class="line">1918</span><br><span class="line">1919</span><br><span class="line">1920</span><br><span class="line">1921</span><br><span class="line">1922</span><br><span class="line">1923</span><br><span class="line">1924</span><br><span class="line">1925</span><br><span class="line">1926</span><br><span class="line">1927</span><br><span class="line">1928</span><br><span class="line">1929</span><br><span class="line">1930</span><br><span class="line">1931</span><br><span class="line">1932</span><br><span class="line">1933</span><br><span class="line">1934</span><br><span class="line">1935</span><br><span class="line">1936</span><br><span class="line">1937</span><br><span class="line">1938</span><br><span class="line">1939</span><br><span class="line">1940</span><br><span class="line">1941</span><br><span class="line">1942</span><br><span class="line">1943</span><br><span class="line">1944</span><br><span class="line">1945</span><br><span class="line">1946</span><br><span class="line">1947</span><br><span class="line">1948</span><br><span class="line">1949</span><br><span class="line">1950</span><br><span class="line">1951</span><br><span class="line">1952</span><br><span class="line">1953</span><br><span class="line">1954</span><br><span class="line">1955</span><br><span class="line">1956</span><br><span class="line">1957</span><br><span class="line">1958</span><br><span class="line">1959</span><br><span class="line">1960</span><br><span class="line">1961</span><br><span class="line">1962</span><br><span class="line">1963</span><br><span class="line">1964</span><br><span class="line">1965</span><br><span class="line">1966</span><br><span class="line">1967</span><br><span class="line">1968</span><br><span class="line">1969</span><br><span class="line">1970</span><br><span class="line">1971</span><br><span class="line">1972</span><br><span class="line">1973</span><br><span class="line">1974</span><br><span class="line">1975</span><br><span class="line">1976</span><br><span class="line">1977</span><br><span class="line">1978</span><br><span class="line">1979</span><br><span class="line">1980</span><br><span class="line">1981</span><br><span class="line">1982</span><br><span class="line">1983</span><br><span class="line">1984</span><br><span class="line">1985</span><br><span class="line">1986</span><br><span class="line">1987</span><br><span class="line">1988</span><br><span class="line">1989</span><br><span class="line">1990</span><br><span class="line">1991</span><br><span class="line">1992</span><br><span class="line">1993</span><br><span class="line">1994</span><br><span class="line">1995</span><br><span class="line">1996</span><br><span class="line">1997</span><br><span class="line">1998</span><br><span class="line">1999</span><br><span class="line">2000</span><br><span class="line">2001</span><br><span class="line">2002</span><br><span class="line">2003</span><br><span class="line">2004</span><br><span class="line">2005</span><br><span class="line">2006</span><br><span class="line">2007</span><br><span class="line">2008</span><br><span class="line">2009</span><br><span class="line">2010</span><br><span class="line">2011</span><br><span class="line">2012</span><br><span class="line">2013</span><br><span class="line">2014</span><br><span class="line">2015</span><br><span class="line">2016</span><br><span class="line">2017</span><br><span class="line">2018</span><br><span class="line">2019</span><br><span class="line">2020</span><br><span class="line">2021</span><br><span class="line">2022</span><br><span class="line">2023</span><br><span class="line">2024</span><br><span class="line">2025</span><br><span class="line">2026</span><br><span class="line">2027</span><br><span class="line">2028</span><br><span class="line">2029</span><br><span class="line">2030</span><br><span class="line">2031</span><br><span class="line">2032</span><br><span class="line">2033</span><br><span class="line">2034</span><br><span class="line">2035</span><br><span class="line">2036</span><br><span class="line">2037</span><br><span class="line">2038</span><br><span class="line">2039</span><br><span class="line">2040</span><br><span class="line">2041</span><br><span class="line">2042</span><br><span class="line">2043</span><br><span class="line">2044</span><br><span class="line">2045</span><br><span class="line">2046</span><br><span class="line">2047</span><br><span class="line">2048</span><br><span class="line">2049</span><br><span class="line">2050</span><br><span class="line">2051</span><br><span class="line">2052</span><br><span class="line">2053</span><br><span class="line">2054</span><br><span class="line">2055</span><br><span class="line">2056</span><br><span class="line">2057</span><br><span class="line">2058</span><br><span class="line">2059</span><br><span class="line">2060</span><br><span class="line">2061</span><br><span class="line">2062</span><br><span class="line">2063</span><br><span class="line">2064</span><br><span class="line">2065</span><br><span class="line">2066</span><br><span class="line">2067</span><br><span class="line">2068</span><br><span class="line">2069</span><br><span class="line">2070</span><br><span class="line">2071</span><br><span class="line">2072</span><br><span class="line">2073</span><br><span class="line">2074</span><br><span class="line">2075</span><br><span class="line">2076</span><br><span class="line">2077</span><br><span class="line">2078</span><br><span class="line">2079</span><br><span class="line">2080</span><br><span class="line">2081</span><br><span class="line">2082</span><br><span class="line">2083</span><br><span class="line">2084</span><br><span class="line">2085</span><br><span class="line">2086</span><br><span class="line">2087</span><br><span class="line">2088</span><br><span class="line">2089</span><br><span class="line">2090</span><br><span class="line">2091</span><br><span class="line">2092</span><br><span class="line">2093</span><br><span class="line">2094</span><br><span class="line">2095</span><br><span class="line">2096</span><br><span class="line">2097</span><br><span class="line">2098</span><br><span class="line">2099</span><br><span class="line">2100</span><br><span class="line">2101</span><br><span class="line">2102</span><br><span class="line">2103</span><br><span class="line">2104</span><br><span class="line">2105</span><br><span class="line">2106</span><br><span class="line">2107</span><br><span class="line">2108</span><br><span class="line">2109</span><br><span class="line">2110</span><br><span class="line">2111</span><br><span class="line">2112</span><br><span class="line">2113</span><br><span class="line">2114</span><br><span class="line">2115</span><br><span class="line">2116</span><br><span class="line">2117</span><br><span class="line">2118</span><br><span class="line">2119</span><br><span class="line">2120</span><br><span class="line">2121</span><br><span class="line">2122</span><br><span class="line">2123</span><br><span class="line">2124</span><br><span class="line">2125</span><br><span class="line">2126</span><br><span class="line">2127</span><br><span class="line">2128</span><br><span class="line">2129</span><br><span class="line">2130</span><br><span class="line">2131</span><br><span class="line">2132</span><br><span class="line">2133</span><br><span class="line">2134</span><br><span class="line">2135</span><br><span class="line">2136</span><br><span class="line">2137</span><br><span class="line">2138</span><br><span class="line">2139</span><br><span class="line">2140</span><br><span class="line">2141</span><br><span class="line">2142</span><br><span class="line">2143</span><br><span class="line">2144</span><br><span class="line">2145</span><br><span class="line">2146</span><br><span class="line">2147</span><br><span class="line">2148</span><br><span class="line">2149</span><br><span class="line">2150</span><br><span class="line">2151</span><br><span class="line">2152</span><br><span class="line">2153</span><br><span class="line">2154</span><br><span class="line">2155</span><br><span class="line">2156</span><br><span class="line">2157</span><br><span class="line">2158</span><br><span class="line">2159</span><br><span class="line">2160</span><br><span class="line">2161</span><br><span class="line">2162</span><br><span class="line">2163</span><br><span class="line">2164</span><br><span class="line">2165</span><br><span class="line">2166</span><br><span class="line">2167</span><br><span class="line">2168</span><br><span class="line">2169</span><br><span class="line">2170</span><br><span class="line">2171</span><br><span class="line">2172</span><br><span class="line">2173</span><br><span class="line">2174</span><br><span class="line">2175</span><br><span class="line">2176</span><br><span class="line">2177</span><br><span class="line">2178</span><br><span class="line">2179</span><br><span class="line">2180</span><br><span class="line">2181</span><br><span class="line">2182</span><br><span class="line">2183</span><br><span class="line">2184</span><br><span class="line">2185</span><br><span class="line">2186</span><br><span class="line">2187</span><br><span class="line">2188</span><br><span class="line">2189</span><br><span class="line">2190</span><br><span class="line">2191</span><br><span class="line">2192</span><br><span class="line">2193</span><br><span class="line">2194</span><br><span class="line">2195</span><br><span class="line">2196</span><br><span class="line">2197</span><br><span class="line">2198</span><br><span class="line">2199</span><br><span class="line">2200</span><br><span class="line">2201</span><br><span class="line">2202</span><br><span class="line">2203</span><br><span class="line">2204</span><br><span class="line">2205</span><br><span class="line">2206</span><br><span class="line">2207</span><br><span class="line">2208</span><br><span class="line">2209</span><br><span class="line">2210</span><br><span class="line">2211</span><br><span class="line">2212</span><br><span class="line">2213</span><br><span class="line">2214</span><br><span class="line">2215</span><br><span class="line">2216</span><br><span class="line">2217</span><br><span class="line">2218</span><br><span class="line">2219</span><br><span class="line">2220</span><br><span class="line">2221</span><br><span class="line">2222</span><br><span class="line">2223</span><br><span class="line">2224</span><br><span class="line">2225</span><br><span class="line">2226</span><br><span class="line">2227</span><br><span class="line">2228</span><br><span class="line">2229</span><br><span class="line">2230</span><br><span class="line">2231</span><br><span class="line">2232</span><br><span class="line">2233</span><br><span class="line">2234</span><br><span class="line">2235</span><br><span class="line">2236</span><br><span class="line">2237</span><br><span class="line">2238</span><br><span class="line">2239</span><br><span class="line">2240</span><br><span class="line">2241</span><br><span class="line">2242</span><br><span class="line">2243</span><br><span class="line">2244</span><br><span class="line">2245</span><br><span class="line">2246</span><br><span class="line">2247</span><br><span class="line">2248</span><br><span class="line">2249</span><br><span class="line">2250</span><br><span class="line">2251</span><br><span class="line">2252</span><br><span class="line">2253</span><br><span class="line">2254</span><br><span class="line">2255</span><br><span class="line">2256</span><br><span class="line">2257</span><br><span class="line">2258</span><br><span class="line">2259</span><br><span class="line">2260</span><br><span class="line">2261</span><br><span class="line">2262</span><br><span class="line">2263</span><br><span class="line">2264</span><br><span class="line">2265</span><br><span class="line">2266</span><br><span class="line">2267</span><br><span class="line">2268</span><br><span class="line">2269</span><br><span class="line">2270</span><br><span class="line">2271</span><br><span class="line">2272</span><br><span class="line">2273</span><br><span class="line">2274</span><br><span class="line">2275</span><br><span class="line">2276</span><br><span class="line">2277</span><br><span class="line">2278</span><br><span class="line">2279</span><br><span class="line">2280</span><br><span class="line">2281</span><br><span class="line">2282</span><br><span class="line">2283</span><br><span class="line">2284</span><br><span class="line">2285</span><br><span class="line">2286</span><br><span class="line">2287</span><br><span class="line">2288</span><br><span class="line">2289</span><br><span class="line">2290</span><br><span class="line">2291</span><br><span class="line">2292</span><br><span class="line">2293</span><br><span class="line">2294</span><br><span class="line">2295</span><br><span class="line">2296</span><br><span class="line">2297</span><br><span class="line">2298</span><br><span class="line">2299</span><br><span class="line">2300</span><br><span class="line">2301</span><br><span class="line">2302</span><br><span class="line">2303</span><br><span class="line">2304</span><br><span class="line">2305</span><br><span class="line">2306</span><br><span class="line">2307</span><br><span class="line">2308</span><br><span class="line">2309</span><br><span class="line">2310</span><br><span class="line">2311</span><br><span class="line">2312</span><br><span class="line">2313</span><br><span class="line">2314</span><br><span class="line">2315</span><br><span class="line">2316</span><br><span class="line">2317</span><br><span class="line">2318</span><br><span class="line">2319</span><br><span class="line">2320</span><br><span class="line">2321</span><br><span class="line">2322</span><br><span class="line">2323</span><br><span class="line">2324</span><br><span class="line">2325</span><br><span class="line">2326</span><br><span class="line">2327</span><br><span class="line">2328</span><br><span class="line">2329</span><br><span class="line">2330</span><br><span class="line">2331</span><br><span class="line">2332</span><br><span class="line">2333</span><br><span class="line">2334</span><br><span class="line">2335</span><br><span class="line">2336</span><br><span class="line">2337</span><br><span class="line">2338</span><br><span class="line">2339</span><br><span class="line">2340</span><br><span class="line">2341</span><br><span class="line">2342</span><br><span class="line">2343</span><br><span class="line">2344</span><br><span class="line">2345</span><br><span class="line">2346</span><br><span class="line">2347</span><br><span class="line">2348</span><br><span class="line">2349</span><br><span class="line">2350</span><br><span class="line">2351</span><br><span class="line">2352</span><br><span class="line">2353</span><br><span class="line">2354</span><br><span class="line">2355</span><br><span class="line">2356</span><br><span class="line">2357</span><br><span class="line">2358</span><br><span class="line">2359</span><br><span class="line">2360</span><br><span class="line">2361</span><br><span class="line">2362</span><br><span class="line">2363</span><br><span class="line">2364</span><br><span class="line">2365</span><br><span class="line">2366</span><br><span class="line">2367</span><br><span class="line">2368</span><br><span class="line">2369</span><br><span class="line">2370</span><br><span class="line">2371</span><br><span class="line">2372</span><br><span class="line">2373</span><br><span class="line">2374</span><br><span class="line">2375</span><br><span class="line">2376</span><br><span class="line">2377</span><br><span class="line">2378</span><br><span class="line">2379</span><br><span class="line">2380</span><br><span class="line">2381</span><br><span class="line">2382</span><br><span class="line">2383</span><br><span class="line">2384</span><br><span class="line">2385</span><br><span class="line">2386</span><br><span class="line">2387</span><br><span class="line">2388</span><br><span class="line">2389</span><br><span class="line">2390</span><br><span class="line">2391</span><br><span class="line">2392</span><br><span class="line">2393</span><br><span class="line">2394</span><br><span class="line">2395</span><br><span class="line">2396</span><br><span class="line">2397</span><br><span class="line">2398</span><br><span class="line">2399</span><br><span class="line">2400</span><br><span class="line">2401</span><br><span class="line">2402</span><br><span class="line">2403</span><br><span class="line">2404</span><br><span class="line">2405</span><br><span class="line">2406</span><br><span class="line">2407</span><br><span class="line">2408</span><br><span class="line">2409</span><br><span class="line">2410</span><br><span class="line">2411</span><br><span class="line">2412</span><br><span class="line">2413</span><br><span class="line">2414</span><br><span class="line">2415</span><br><span class="line">2416</span><br><span class="line">2417</span><br><span class="line">2418</span><br><span class="line">2419</span><br><span class="line">2420</span><br><span class="line">2421</span><br><span class="line">2422</span><br><span class="line">2423</span><br><span class="line">2424</span><br><span class="line">2425</span><br><span class="line">2426</span><br><span class="line">2427</span><br><span class="line">2428</span><br><span class="line">2429</span><br><span class="line">2430</span><br><span class="line">2431</span><br><span class="line">2432</span><br><span class="line">2433</span><br><span class="line">2434</span><br><span class="line">2435</span><br><span class="line">2436</span><br><span class="line">2437</span><br><span class="line">2438</span><br><span class="line">2439</span><br><span class="line">2440</span><br><span class="line">2441</span><br><span class="line">2442</span><br><span class="line">2443</span><br><span class="line">2444</span><br><span class="line">2445</span><br><span class="line">2446</span><br><span class="line">2447</span><br><span class="line">2448</span><br><span class="line">2449</span><br><span class="line">2450</span><br><span class="line">2451</span><br><span class="line">2452</span><br><span class="line">2453</span><br><span class="line">2454</span><br><span class="line">2455</span><br><span class="line">2456</span><br><span class="line">2457</span><br><span class="line">2458</span><br><span class="line">2459</span><br><span class="line">2460</span><br><span class="line">2461</span><br><span class="line">2462</span><br><span class="line">2463</span><br><span class="line">2464</span><br><span class="line">2465</span><br><span class="line">2466</span><br><span class="line">2467</span><br><span class="line">2468</span><br><span class="line">2469</span><br><span class="line">2470</span><br><span class="line">2471</span><br><span class="line">2472</span><br><span class="line">2473</span><br><span class="line">2474</span><br><span class="line">2475</span><br><span class="line">2476</span><br><span class="line">2477</span><br><span class="line">2478</span><br><span class="line">2479</span><br><span class="line">2480</span><br><span class="line">2481</span><br><span class="line">2482</span><br><span class="line">2483</span><br><span class="line">2484</span><br><span class="line">2485</span><br><span class="line">2486</span><br><span class="line">2487</span><br><span class="line">2488</span><br><span class="line">2489</span><br><span class="line">2490</span><br><span class="line">2491</span><br><span class="line">2492</span><br><span class="line">2493</span><br><span class="line">2494</span><br><span class="line">2495</span><br><span class="line">2496</span><br><span class="line">2497</span><br><span class="line">2498</span><br><span class="line">2499</span><br><span class="line">2500</span><br><span class="line">2501</span><br><span class="line">2502</span><br><span class="line">2503</span><br><span class="line">2504</span><br><span class="line">2505</span><br><span class="line">2506</span><br><span class="line">2507</span><br><span class="line">2508</span><br><span class="line">2509</span><br><span class="line">2510</span><br><span class="line">2511</span><br><span class="line">2512</span><br><span class="line">2513</span><br><span class="line">2514</span><br><span class="line">2515</span><br><span class="line">2516</span><br><span class="line">2517</span><br><span class="line">2518</span><br><span class="line">2519</span><br><span class="line">2520</span><br><span class="line">2521</span><br><span class="line">2522</span><br><span class="line">2523</span><br><span class="line">2524</span><br><span class="line">2525</span><br><span class="line">2526</span><br><span class="line">2527</span><br><span class="line">2528</span><br><span class="line">2529</span><br><span class="line">2530</span><br><span class="line">2531</span><br></pre></td><td class="code"><pre><span class="line">/*~ class.phpmailer.php</span><br><span class="line">.---------------------------------------------------------------------------.</span><br><span class="line">|  Software: PHPMailer - PHP email class                                    |</span><br><span class="line">|   Version: 5.2.1                                                          |</span><br><span class="line">|      Site: https://code.google.com/a/apache-extras.org/p/phpmailer/       |</span><br><span class="line">| ------------------------------------------------------------------------- |</span><br><span class="line">|     Admin: Jim Jagielski (project admininistrator)                        |</span><br><span class="line">|   Authors: Andy Prevost (codeworxtech) codeworxtech@users.sourceforge.net |</span><br><span class="line">|          : Marcus Bointon (coolbru) coolbru@users.sourceforge.net         |</span><br><span class="line">|          : Jim Jagielski (jimjag) jimjag@gmail.com                        |</span><br><span class="line">|   Founder: Brent R. Matzelle (original founder)                           |</span><br><span class="line">| Copyright (c) 2010-2012, Jim Jagielski. All Rights Reserved.              |</span><br><span class="line">| Copyright (c) 2004-2009, Andy Prevost. All Rights Reserved.               |</span><br><span class="line">| Copyright (c) 2001-2003, Brent R. Matzelle                                |</span><br><span class="line">| ------------------------------------------------------------------------- |</span><br><span class="line">|   License: Distributed under the Lesser General Public License (LGPL)     |</span><br><span class="line">|            http://www.gnu.org/copyleft/lesser.html                        |</span><br><span class="line">| This program is distributed in the hope that it will be useful - WITHOUT  |</span><br><span class="line">| ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or     |</span><br><span class="line">| FITNESS FOR A PARTICULAR PURPOSE.                                         |</span><br><span class="line">&#x27;---------------------------------------------------------------------------&#x27;</span><br><span class="line">*/</span><br><span class="line">namespace Org\Util;</span><br><span class="line">use Think\Exception;</span><br><span class="line">/**</span><br><span class="line"> * PHPMailer - PHP email transport class</span><br><span class="line"> * NOTE: Requires PHP version 5 or later</span><br><span class="line"> * @package PHPMailer</span><br><span class="line"> * @author Andy Prevost</span><br><span class="line"> * @author Marcus Bointon</span><br><span class="line"> * @author Jim Jagielski</span><br><span class="line"> * @copyright 2010 - 2012 Jim Jagielski</span><br><span class="line"> * @copyright 2004 - 2009 Andy Prevost</span><br><span class="line"> * @version $Id: class.phpmailer.php 450 2010-06-23 16:46:33Z coolbru $</span><br><span class="line"> * @license http://www.gnu.org/copyleft/lesser.html GNU Lesser General Public License</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">if (version_compare(PHP_VERSION, &#x27;5.0.0&#x27;, &#x27;&lt;&#x27;) ) exit(&quot;Sorry, this version of PHPMailer will only run on PHP version 5 or greater!\n&quot;);</span><br><span class="line"></span><br><span class="line">class PHPMailer &#123;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // PROPERTIES, PUBLIC</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Email priority (1 = High, 3 = Normal, 5 = low).</span><br><span class="line">   * @var int</span><br><span class="line">   */</span><br><span class="line">  public $Priority          = 3;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the CharSet of the message.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $CharSet           = &#x27;iso-8859-1&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the Content-type of the message.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $ContentType       = &#x27;text/plain&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the Encoding of the message. Options for this are</span><br><span class="line">   *  &quot;8bit&quot;, &quot;7bit&quot;, &quot;binary&quot;, &quot;base64&quot;, and &quot;quoted-printable&quot;.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $Encoding          = &#x27;8bit&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Holds the most recent mailer error message.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $ErrorInfo         = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the From email address for the message.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $From              = &#x27;root@localhost&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the From name of the message.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $FromName          = &#x27;Root User&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the Sender email (Return-Path) of the message.  If not empty,</span><br><span class="line">   * will be sent via -f to sendmail or as &#x27;MAIL FROM&#x27; in smtp mode.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $Sender            = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the Subject of the message.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $Subject           = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the Body of the message.  This can be either an HTML or text body.</span><br><span class="line">   * If HTML then run IsHTML(true).</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $Body              = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the text-only body of the message.  This automatically sets the</span><br><span class="line">   * email to multipart/alternative.  This body can be read by mail</span><br><span class="line">   * clients that do not have HTML email capability such as mutt. Clients</span><br><span class="line">   * that can read HTML will view the normal Body.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $AltBody           = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Stores the complete compiled MIME message body.</span><br><span class="line">   * @var string</span><br><span class="line">   * @access protected</span><br><span class="line">   */</span><br><span class="line">  protected $MIMEBody       = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Stores the complete compiled MIME message headers.</span><br><span class="line">   * @var string</span><br><span class="line">   * @access protected</span><br><span class="line">   */</span><br><span class="line">  protected $MIMEHeader     = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Stores the complete sent MIME message (Body and Headers)</span><br><span class="line">   * @var string</span><br><span class="line">   * @access protected</span><br><span class="line">  */</span><br><span class="line">  protected $SentMIMEMessage     = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets word wrapping on the body of the message to a given number of</span><br><span class="line">   * characters.</span><br><span class="line">   * @var int</span><br><span class="line">   */</span><br><span class="line">  public $WordWrap          = 0;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Method to send mail: (&quot;mail&quot;, &quot;sendmail&quot;, or &quot;smtp&quot;).</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $Mailer            = &#x27;mail&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the path of the sendmail program.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $Sendmail          = &#x27;/usr/sbin/sendmail&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Path to PHPMailer plugins.  Useful if the SMTP class</span><br><span class="line">   * is in a different directory than the PHP include path.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $PluginDir         = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the email address that a reading confirmation will be sent.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $ConfirmReadingTo  = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the hostname to use in Message-Id and Received headers</span><br><span class="line">   * and as default HELO string. If empty, the value returned</span><br><span class="line">   * by SERVER_NAME is used or &#x27;localhost.localdomain&#x27;.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $Hostname          = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the message ID to be used in the Message-Id header.</span><br><span class="line">   * If empty, a unique id will be generated.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $MessageID         = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // PROPERTIES FOR SMTP</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the SMTP hosts.  All hosts must be separated by a</span><br><span class="line">   * semicolon.  You can also specify a different port</span><br><span class="line">   * for each host by using this format: [hostname:port]</span><br><span class="line">   * (e.g. &quot;smtp1.example.com:25;smtp2.example.com&quot;).</span><br><span class="line">   * Hosts will be tried in order.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $Host          = &#x27;localhost&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the default SMTP server port.</span><br><span class="line">   * @var int</span><br><span class="line">   */</span><br><span class="line">  public $Port          = 25;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the SMTP HELO of the message (Default is $Hostname).</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $Helo          = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets connection prefix.</span><br><span class="line">   * Options are &quot;&quot;, &quot;ssl&quot; or &quot;tls&quot;</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $SMTPSecure    = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets SMTP authentication. Utilizes the Username and Password variables.</span><br><span class="line">   * @var bool</span><br><span class="line">   */</span><br><span class="line">  public $SMTPAuth      = false;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets SMTP username.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $Username      = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets SMTP password.</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $Password      = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the SMTP server timeout in seconds.</span><br><span class="line">   * This function will not work with the win32 version.</span><br><span class="line">   * @var int</span><br><span class="line">   */</span><br><span class="line">  public $Timeout       = 10;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets SMTP class debugging on or off.</span><br><span class="line">   * @var bool</span><br><span class="line">   */</span><br><span class="line">  public $SMTPDebug     = false;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Prevents the SMTP connection from being closed after each mail</span><br><span class="line">   * sending.  If this is set to true then to close the connection</span><br><span class="line">   * requires an explicit call to SmtpClose().</span><br><span class="line">   * @var bool</span><br><span class="line">   */</span><br><span class="line">  public $SMTPKeepAlive = false;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Provides the ability to have the TO field process individual</span><br><span class="line">   * emails, instead of sending to entire TO addresses</span><br><span class="line">   * @var bool</span><br><span class="line">   */</span><br><span class="line">  public $SingleTo      = false;</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">   * If SingleTo is true, this provides the array to hold the email addresses</span><br><span class="line">   * @var bool</span><br><span class="line">   */</span><br><span class="line">  public $SingleToArray = array();</span><br><span class="line"></span><br><span class="line"> /**</span><br><span class="line">   * Provides the ability to change the line ending</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $LE              = &quot;\n&quot;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Used with DKIM DNS Resource Record</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $DKIM_selector   = &#x27;phpmailer&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Used with DKIM DNS Resource Record</span><br><span class="line">   * optional, in format of email address &#x27;you@yourdomain.com&#x27;</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $DKIM_identity   = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Used with DKIM DNS Resource Record</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $DKIM_passphrase   = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Used with DKIM DNS Resource Record</span><br><span class="line">   * optional, in format of email address &#x27;you@yourdomain.com&#x27;</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $DKIM_domain     = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Used with DKIM DNS Resource Record</span><br><span class="line">   * optional, in format of email address &#x27;you@yourdomain.com&#x27;</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $DKIM_private    = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Callback Action function name</span><br><span class="line">   * the function that handles the result of the send email action. Parameters:</span><br><span class="line">   *   bool    $result        result of the send action</span><br><span class="line">   *   string  $to            email address of the recipient</span><br><span class="line">   *   string  $cc            cc email addresses</span><br><span class="line">   *   string  $bcc           bcc email addresses</span><br><span class="line">   *   string  $subject       the subject</span><br><span class="line">   *   string  $body          the email body</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $action_function = &#x27;&#x27;; //&#x27;callbackAction&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the PHPMailer Version number</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $Version         = &#x27;5.2.1&#x27;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * What to use in the X-Mailer header</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $XMailer         = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // PROPERTIES, PRIVATE AND PROTECTED</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  protected   $smtp           = NULL;</span><br><span class="line">  protected   $to             = array();</span><br><span class="line">  protected   $cc             = array();</span><br><span class="line">  protected   $bcc            = array();</span><br><span class="line">  protected   $ReplyTo        = array();</span><br><span class="line">  protected   $all_recipients = array();</span><br><span class="line">  protected   $attachment     = array();</span><br><span class="line">  protected   $CustomHeader   = array();</span><br><span class="line">  protected   $message_type   = &#x27;&#x27;;</span><br><span class="line">  protected   $boundary       = array();</span><br><span class="line">  protected   $language       = array();</span><br><span class="line">  protected   $error_count    = 0;</span><br><span class="line">  protected   $sign_cert_file = &#x27;&#x27;;</span><br><span class="line">  protected   $sign_key_file  = &#x27;&#x27;;</span><br><span class="line">  protected   $sign_key_pass  = &#x27;&#x27;;</span><br><span class="line">  protected   $exceptions     = false;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // CONSTANTS</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  const STOP_MESSAGE  = 0; // message only, continue processing</span><br><span class="line">  const STOP_CONTINUE = 1; // message?, likely ok to continue processing</span><br><span class="line">  const STOP_CRITICAL = 2; // message, plus full stop, critical error reached</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // METHODS, VARIABLES</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Constructor</span><br><span class="line">   * @param boolean $exceptions Should we throw external exceptions?</span><br><span class="line">   */</span><br><span class="line">  public function __construct($exceptions = false) &#123;</span><br><span class="line">    $this-&gt;exceptions = ($exceptions == true);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets message type to HTML.</span><br><span class="line">   * @param bool $ishtml</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function IsHTML($ishtml = true) &#123;</span><br><span class="line">    if ($ishtml) &#123;</span><br><span class="line">      $this-&gt;ContentType = &#x27;text/html&#x27;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      $this-&gt;ContentType = &#x27;text/plain&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets Mailer to send message using SMTP.</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function IsSMTP() &#123;</span><br><span class="line">    $this-&gt;Mailer = &#x27;smtp&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets Mailer to send message using PHP mail() function.</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function IsMail() &#123;</span><br><span class="line">    $this-&gt;Mailer = &#x27;mail&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets Mailer to send message using the $Sendmail program.</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function IsSendmail() &#123;</span><br><span class="line">    if (!stristr(ini_get(&#x27;sendmail_path&#x27;), &#x27;sendmail&#x27;)) &#123;</span><br><span class="line">      $this-&gt;Sendmail = &#x27;/var/qmail/bin/sendmail&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    $this-&gt;Mailer = &#x27;sendmail&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets Mailer to send message using the qmail MTA.</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function IsQmail() &#123;</span><br><span class="line">    if (stristr(ini_get(&#x27;sendmail_path&#x27;), &#x27;qmail&#x27;)) &#123;</span><br><span class="line">      $this-&gt;Sendmail = &#x27;/var/qmail/bin/sendmail&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    $this-&gt;Mailer = &#x27;sendmail&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // METHODS, RECIPIENTS</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Adds a &quot;To&quot; address.</span><br><span class="line">   * @param string $address</span><br><span class="line">   * @param string $name</span><br><span class="line">   * @return boolean true on success, false if address already used</span><br><span class="line">   */</span><br><span class="line">  public function AddAddress($address, $name = &#x27;&#x27;) &#123;</span><br><span class="line">    return $this-&gt;AddAnAddress(&#x27;to&#x27;, $address, $name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Adds a &quot;Cc&quot; address.</span><br><span class="line">   * Note: this function works with the SMTP mailer on win32, not with the &quot;mail&quot; mailer.</span><br><span class="line">   * @param string $address</span><br><span class="line">   * @param string $name</span><br><span class="line">   * @return boolean true on success, false if address already used</span><br><span class="line">   */</span><br><span class="line">  public function AddCC($address, $name = &#x27;&#x27;) &#123;</span><br><span class="line">    return $this-&gt;AddAnAddress(&#x27;cc&#x27;, $address, $name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Adds a &quot;Bcc&quot; address.</span><br><span class="line">   * Note: this function works with the SMTP mailer on win32, not with the &quot;mail&quot; mailer.</span><br><span class="line">   * @param string $address</span><br><span class="line">   * @param string $name</span><br><span class="line">   * @return boolean true on success, false if address already used</span><br><span class="line">   */</span><br><span class="line">  public function AddBCC($address, $name = &#x27;&#x27;) &#123;</span><br><span class="line">    return $this-&gt;AddAnAddress(&#x27;bcc&#x27;, $address, $name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Adds a &quot;Reply-to&quot; address.</span><br><span class="line">   * @param string $address</span><br><span class="line">   * @param string $name</span><br><span class="line">   * @return boolean</span><br><span class="line">   */</span><br><span class="line">  public function AddReplyTo($address, $name = &#x27;&#x27;) &#123;</span><br><span class="line">    return $this-&gt;AddAnAddress(&#x27;Reply-To&#x27;, $address, $name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Adds an address to one of the recipient arrays</span><br><span class="line">   * Addresses that have been added already return false, but do not throw exceptions</span><br><span class="line">   * @param string $kind One of &#x27;to&#x27;, &#x27;cc&#x27;, &#x27;bcc&#x27;, &#x27;ReplyTo&#x27;</span><br><span class="line">   * @param string $address The email address to send to</span><br><span class="line">   * @param string $name</span><br><span class="line">   * @return boolean true on success, false if address already used or invalid in some way</span><br><span class="line">   * @access protected</span><br><span class="line">   */</span><br><span class="line">  protected function AddAnAddress($kind, $address, $name = &#x27;&#x27;) &#123;</span><br><span class="line">    if (!preg_match(&#x27;/^(to|cc|bcc|Reply-To)$/&#x27;, $kind)) &#123;</span><br><span class="line">      $this-&gt;SetError($this-&gt;Lang(&#x27;Invalid recipient array&#x27;).&#x27;: &#x27;.$kind);</span><br><span class="line">      if ($this-&gt;exceptions) &#123;</span><br><span class="line">        throw new phpmailerException(&#x27;Invalid recipient array: &#x27; . $kind);</span><br><span class="line">      &#125;</span><br><span class="line">      if ($this-&gt;SMTPDebug) &#123;</span><br><span class="line">        echo $this-&gt;Lang(&#x27;Invalid recipient array&#x27;).&#x27;: &#x27;.$kind;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">    $address = trim($address);</span><br><span class="line">    $name = trim(preg_replace(&#x27;/[\r\n]+/&#x27;, &#x27;&#x27;, $name)); //Strip breaks and trim</span><br><span class="line">    if (!self::ValidateAddress($address)) &#123;</span><br><span class="line">      $this-&gt;SetError($this-&gt;Lang(&#x27;invalid_address&#x27;).&#x27;: &#x27;. $address);</span><br><span class="line">      if ($this-&gt;exceptions) &#123;</span><br><span class="line">        throw new phpmailerException($this-&gt;Lang(&#x27;invalid_address&#x27;).&#x27;: &#x27;.$address);</span><br><span class="line">      &#125;</span><br><span class="line">      if ($this-&gt;SMTPDebug) &#123;</span><br><span class="line">        echo $this-&gt;Lang(&#x27;invalid_address&#x27;).&#x27;: &#x27;.$address;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">    if ($kind != &#x27;Reply-To&#x27;) &#123;</span><br><span class="line">      if (!isset($this-&gt;all_recipients[strtolower($address)])) &#123;</span><br><span class="line">        array_push($this-&gt;$kind, array($address, $name));</span><br><span class="line">        $this-&gt;all_recipients[strtolower($address)] = true;</span><br><span class="line">        return true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      if (!array_key_exists(strtolower($address), $this-&gt;ReplyTo)) &#123;</span><br><span class="line">        $this-&gt;ReplyTo[strtolower($address)] = array($address, $name);</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Set the From and FromName properties</span><br><span class="line"> * @param string $address</span><br><span class="line"> * @param string $name</span><br><span class="line"> * @return boolean</span><br><span class="line"> */</span><br><span class="line">  public function SetFrom($address, $name = &#x27;&#x27;, $auto = 1) &#123;</span><br><span class="line">    $address = trim($address);</span><br><span class="line">    $name = trim(preg_replace(&#x27;/[\r\n]+/&#x27;, &#x27;&#x27;, $name)); //Strip breaks and trim</span><br><span class="line">    if (!self::ValidateAddress($address)) &#123;</span><br><span class="line">      $this-&gt;SetError($this-&gt;Lang(&#x27;invalid_address&#x27;).&#x27;: &#x27;. $address);</span><br><span class="line">      if ($this-&gt;exceptions) &#123;</span><br><span class="line">        throw new phpmailerException($this-&gt;Lang(&#x27;invalid_address&#x27;).&#x27;: &#x27;.$address);</span><br><span class="line">      &#125;</span><br><span class="line">      if ($this-&gt;SMTPDebug) &#123;</span><br><span class="line">        echo $this-&gt;Lang(&#x27;invalid_address&#x27;).&#x27;: &#x27;.$address;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">    $this-&gt;From = $address;</span><br><span class="line">    $this-&gt;FromName = $name;</span><br><span class="line">    if ($auto) &#123;</span><br><span class="line">      if (empty($this-&gt;ReplyTo)) &#123;</span><br><span class="line">        $this-&gt;AddAnAddress(&#x27;Reply-To&#x27;, $address, $name);</span><br><span class="line">      &#125;</span><br><span class="line">      if (empty($this-&gt;Sender)) &#123;</span><br><span class="line">        $this-&gt;Sender = $address;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Check that a string looks roughly like an email address should</span><br><span class="line">   * Static so it can be used without instantiation</span><br><span class="line">   * Tries to use PHP built-in validator in the filter extension (from PHP 5.2), falls back to a reasonably competent regex validator</span><br><span class="line">   * Conforms approximately to RFC2822</span><br><span class="line">   * @link http://www.hexillion.com/samples/#Regex Original pattern found here</span><br><span class="line">   * @param string $address The email address to check</span><br><span class="line">   * @return boolean</span><br><span class="line">   * @static</span><br><span class="line">   * @access public</span><br><span class="line">   */</span><br><span class="line">  public static function ValidateAddress($address) &#123;</span><br><span class="line">    if (function_exists(&#x27;filter_var&#x27;)) &#123; //Introduced in PHP 5.2</span><br><span class="line">      if(filter_var($address, FILTER_VALIDATE_EMAIL) === FALSE) &#123;</span><br><span class="line">        return false;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return preg_match(&#x27;/^(?:[\w\!\#\$\%\&amp;\&#x27;\*\+\-\/\=\?\^\`\&#123;\|\&#125;\~]+\.)*[\w\!\#\$\%\&amp;\&#x27;\*\+\-\/\=\?\^\`\&#123;\|\&#125;\~]+@(?:(?:(?:[a-zA-Z0-9_](?:[a-zA-Z0-9_\-](?!\.))&#123;0,61&#125;[a-zA-Z0-9_-]?\.)+[a-zA-Z0-9_](?:[a-zA-Z0-9_\-](?!$))&#123;0,61&#125;[a-zA-Z0-9_]?)|(?:\[(?:(?:[01]?\d&#123;1,2&#125;|2[0-4]\d|25[0-5])\.)&#123;3&#125;(?:[01]?\d&#123;1,2&#125;|2[0-4]\d|25[0-5])\]))$/&#x27;, $address);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // METHODS, MAIL SENDING</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Creates message and assigns Mailer. If the message is</span><br><span class="line">   * not sent successfully then it returns false.  Use the ErrorInfo</span><br><span class="line">   * variable to view description of the error.</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function Send() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      if(!$this-&gt;PreSend()) return false;</span><br><span class="line">      return $this-&gt;PostSend();</span><br><span class="line">    &#125; catch (phpmailerException $e) &#123;</span><br><span class="line">      $this-&gt;SentMIMEMessage = &#x27;&#x27;;</span><br><span class="line">      $this-&gt;SetError($e-&gt;getMessage());</span><br><span class="line">      if ($this-&gt;exceptions) &#123;</span><br><span class="line">        throw $e;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  protected function PreSend() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      $mailHeader = &quot;&quot;;</span><br><span class="line">      if ((count($this-&gt;to) + count($this-&gt;cc) + count($this-&gt;bcc)) &lt; 1) &#123;</span><br><span class="line">        throw new phpmailerException($this-&gt;Lang(&#x27;provide_address&#x27;), self::STOP_CRITICAL);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // Set whether the message is multipart/alternative</span><br><span class="line">      if(!empty($this-&gt;AltBody)) &#123;</span><br><span class="line">        $this-&gt;ContentType = &#x27;multipart/alternative&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      $this-&gt;error_count = 0; // reset errors</span><br><span class="line">      $this-&gt;SetMessageType();</span><br><span class="line">      //Refuse to send an empty message</span><br><span class="line">      if (empty($this-&gt;Body)) &#123;</span><br><span class="line">        throw new phpmailerException($this-&gt;Lang(&#x27;empty_message&#x27;), self::STOP_CRITICAL);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      $this-&gt;MIMEHeader = $this-&gt;CreateHeader();</span><br><span class="line">      $this-&gt;MIMEBody = $this-&gt;CreateBody();</span><br><span class="line"></span><br><span class="line">      // To capture the complete message when using mail(), create</span><br><span class="line">      // an extra header list which CreateHeader() doesn&#x27;t fold in</span><br><span class="line">      if ($this-&gt;Mailer == &#x27;mail&#x27;) &#123;</span><br><span class="line">        if (count($this-&gt;to) &gt; 0) &#123;</span><br><span class="line">          $mailHeader .= $this-&gt;AddrAppend(&quot;To&quot;, $this-&gt;to);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          $mailHeader .= $this-&gt;HeaderLine(&quot;To&quot;, &quot;undisclosed-recipients:;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        $mailHeader .= $this-&gt;HeaderLine(&#x27;Subject&#x27;, $this-&gt;EncodeHeader($this-&gt;SecureHeader(trim($this-&gt;Subject))));</span><br><span class="line">        // if(count($this-&gt;cc) &gt; 0) &#123;</span><br><span class="line">            // $mailHeader .= $this-&gt;AddrAppend(&quot;Cc&quot;, $this-&gt;cc);</span><br><span class="line">        // &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // digitally sign with DKIM if enabled</span><br><span class="line">      if ($this-&gt;DKIM_domain &amp;&amp; $this-&gt;DKIM_private) &#123;</span><br><span class="line">        $header_dkim = $this-&gt;DKIM_Add($this-&gt;MIMEHeader, $this-&gt;EncodeHeader($this-&gt;SecureHeader($this-&gt;Subject)), $this-&gt;MIMEBody);</span><br><span class="line">        $this-&gt;MIMEHeader = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $header_dkim) . $this-&gt;MIMEHeader;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      $this-&gt;SentMIMEMessage = sprintf(&quot;%s%s\r\n\r\n%s&quot;,$this-&gt;MIMEHeader,$mailHeader,$this-&gt;MIMEBody);</span><br><span class="line">      return true;</span><br><span class="line"></span><br><span class="line">    &#125; catch (phpmailerException $e) &#123;</span><br><span class="line">      $this-&gt;SetError($e-&gt;getMessage());</span><br><span class="line">      if ($this-&gt;exceptions) &#123;</span><br><span class="line">        throw $e;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  protected function PostSend() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      // Choose the mailer and send through it</span><br><span class="line">      switch($this-&gt;Mailer) &#123;</span><br><span class="line">        case &#x27;sendmail&#x27;:</span><br><span class="line">          return $this-&gt;SendmailSend($this-&gt;MIMEHeader, $this-&gt;MIMEBody);</span><br><span class="line">        case &#x27;smtp&#x27;:</span><br><span class="line">          return $this-&gt;SmtpSend($this-&gt;MIMEHeader, $this-&gt;MIMEBody);</span><br><span class="line">        case &#x27;mail&#x27;:</span><br><span class="line">          return $this-&gt;MailSend($this-&gt;MIMEHeader, $this-&gt;MIMEBody);</span><br><span class="line">        default:</span><br><span class="line">          return $this-&gt;MailSend($this-&gt;MIMEHeader, $this-&gt;MIMEBody);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125; catch (phpmailerException $e) &#123;</span><br><span class="line">      $this-&gt;SetError($e-&gt;getMessage());</span><br><span class="line">      if ($this-&gt;exceptions) &#123;</span><br><span class="line">        throw $e;</span><br><span class="line">      &#125;</span><br><span class="line">      if ($this-&gt;SMTPDebug) &#123;</span><br><span class="line">        echo $e-&gt;getMessage().&quot;\n&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sends mail using the $Sendmail program.</span><br><span class="line">   * @param string $header The message headers</span><br><span class="line">   * @param string $body The message body</span><br><span class="line">   * @access protected</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  protected function SendmailSend($header, $body) &#123;</span><br><span class="line">    if ($this-&gt;Sender != &#x27;&#x27;) &#123;</span><br><span class="line">      $sendmail = sprintf(&quot;%s -oi -f %s -t&quot;, escapeshellcmd($this-&gt;Sendmail), escapeshellarg($this-&gt;Sender));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      $sendmail = sprintf(&quot;%s -oi -t&quot;, escapeshellcmd($this-&gt;Sendmail));</span><br><span class="line">    &#125;</span><br><span class="line">    if ($this-&gt;SingleTo === true) &#123;</span><br><span class="line">      foreach ($this-&gt;SingleToArray as $key =&gt; $val) &#123;</span><br><span class="line">        if(!@$mail = popen($sendmail, &#x27;w&#x27;)) &#123;</span><br><span class="line">          throw new phpmailerException($this-&gt;Lang(&#x27;execute&#x27;) . $this-&gt;Sendmail, self::STOP_CRITICAL);</span><br><span class="line">        &#125;</span><br><span class="line">        fputs($mail, &quot;To: &quot; . $val . &quot;\n&quot;);</span><br><span class="line">        fputs($mail, $header);</span><br><span class="line">        fputs($mail, $body);</span><br><span class="line">        $result = pclose($mail);</span><br><span class="line">        // implement call back function if it exists</span><br><span class="line">        $isSent = ($result == 0) ? 1 : 0;</span><br><span class="line">        $this-&gt;doCallback($isSent, $val, $this-&gt;cc, $this-&gt;bcc, $this-&gt;Subject, $body);</span><br><span class="line">        if($result != 0) &#123;</span><br><span class="line">          throw new phpmailerException($this-&gt;Lang(&#x27;execute&#x27;) . $this-&gt;Sendmail, self::STOP_CRITICAL);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      if(!@$mail = popen($sendmail, &#x27;w&#x27;)) &#123;</span><br><span class="line">        throw new phpmailerException($this-&gt;Lang(&#x27;execute&#x27;) . $this-&gt;Sendmail, self::STOP_CRITICAL);</span><br><span class="line">      &#125;</span><br><span class="line">      fputs($mail, $header);</span><br><span class="line">      fputs($mail, $body);</span><br><span class="line">      $result = pclose($mail);</span><br><span class="line">      // implement call back function if it exists</span><br><span class="line">      $isSent = ($result == 0) ? 1 : 0;</span><br><span class="line">      $this-&gt;doCallback($isSent, $this-&gt;to, $this-&gt;cc, $this-&gt;bcc, $this-&gt;Subject, $body);</span><br><span class="line">      if($result != 0) &#123;</span><br><span class="line">        throw new phpmailerException($this-&gt;Lang(&#x27;execute&#x27;) . $this-&gt;Sendmail, self::STOP_CRITICAL);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sends mail using the PHP mail() function.</span><br><span class="line">   * @param string $header The message headers</span><br><span class="line">   * @param string $body The message body</span><br><span class="line">   * @access protected</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  protected function MailSend($header, $body) &#123;</span><br><span class="line">    $toArr = array();</span><br><span class="line">    foreach($this-&gt;to as $t) &#123;</span><br><span class="line">      $toArr[] = $this-&gt;AddrFormat($t);</span><br><span class="line">    &#125;</span><br><span class="line">    $to = implode(&#x27;, &#x27;, $toArr);</span><br><span class="line"></span><br><span class="line">    if (empty($this-&gt;Sender)) &#123;</span><br><span class="line">      $params = &quot;-oi &quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      $params = sprintf(&quot;-oi -f %s&quot;, $this-&gt;Sender);</span><br><span class="line">    &#125;</span><br><span class="line">    if ($this-&gt;Sender != &#x27;&#x27; and !ini_get(&#x27;safe_mode&#x27;)) &#123;</span><br><span class="line">      $old_from = ini_get(&#x27;sendmail_from&#x27;);</span><br><span class="line">      ini_set(&#x27;sendmail_from&#x27;, $this-&gt;Sender);</span><br><span class="line">      if ($this-&gt;SingleTo === true &amp;&amp; count($toArr) &gt; 1) &#123;</span><br><span class="line">        foreach ($toArr as $key =&gt; $val) &#123;</span><br><span class="line">          $rt = @mail($val, $this-&gt;EncodeHeader($this-&gt;SecureHeader($this-&gt;Subject)), $body, $header, $params);</span><br><span class="line">          // implement call back function if it exists</span><br><span class="line">          $isSent = ($rt == 1) ? 1 : 0;</span><br><span class="line">          $this-&gt;doCallback($isSent, $val, $this-&gt;cc, $this-&gt;bcc, $this-&gt;Subject, $body);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        $rt = @mail($to, $this-&gt;EncodeHeader($this-&gt;SecureHeader($this-&gt;Subject)), $body, $header, $params);</span><br><span class="line">        // implement call back function if it exists</span><br><span class="line">        $isSent = ($rt == 1) ? 1 : 0;</span><br><span class="line">        $this-&gt;doCallback($isSent, $to, $this-&gt;cc, $this-&gt;bcc, $this-&gt;Subject, $body);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      if ($this-&gt;SingleTo === true &amp;&amp; count($toArr) &gt; 1) &#123;</span><br><span class="line">        foreach ($toArr as $key =&gt; $val) &#123;</span><br><span class="line">          $rt = @mail($val, $this-&gt;EncodeHeader($this-&gt;SecureHeader($this-&gt;Subject)), $body, $header, $params);</span><br><span class="line">          // implement call back function if it exists</span><br><span class="line">          $isSent = ($rt == 1) ? 1 : 0;</span><br><span class="line">          $this-&gt;doCallback($isSent, $val, $this-&gt;cc, $this-&gt;bcc, $this-&gt;Subject, $body);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        $rt = @mail($to, $this-&gt;EncodeHeader($this-&gt;SecureHeader($this-&gt;Subject)), $body, $header, $params);</span><br><span class="line">        // implement call back function if it exists</span><br><span class="line">        $isSent = ($rt == 1) ? 1 : 0;</span><br><span class="line">        $this-&gt;doCallback($isSent, $to, $this-&gt;cc, $this-&gt;bcc, $this-&gt;Subject, $body);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (isset($old_from)) &#123;</span><br><span class="line">      ini_set(&#x27;sendmail_from&#x27;, $old_from);</span><br><span class="line">    &#125;</span><br><span class="line">    if(!$rt) &#123;</span><br><span class="line">      throw new phpmailerException($this-&gt;Lang(&#x27;instantiate&#x27;), self::STOP_CRITICAL);</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sends mail via SMTP using PhpSMTP</span><br><span class="line">   * Returns false if there is a bad MAIL FROM, RCPT, or DATA input.</span><br><span class="line">   * @param string $header The message headers</span><br><span class="line">   * @param string $body The message body</span><br><span class="line">   * @uses SMTP</span><br><span class="line">   * @access protected</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  protected function SmtpSend($header, $body) &#123;</span><br><span class="line">    require_once $this-&gt;PluginDir . &#x27;Smtp.class.php&#x27;;</span><br><span class="line">    $bad_rcpt = array();</span><br><span class="line"></span><br><span class="line">    if(!$this-&gt;SmtpConnect()) &#123;</span><br><span class="line">      throw new phpmailerException($this-&gt;Lang(&#x27;smtp_connect_failed&#x27;), self::STOP_CRITICAL);</span><br><span class="line">    &#125;</span><br><span class="line">    $smtp_from = ($this-&gt;Sender == &#x27;&#x27;) ? $this-&gt;From : $this-&gt;Sender;</span><br><span class="line">    if(!$this-&gt;smtp-&gt;Mail($smtp_from)) &#123;</span><br><span class="line">      throw new phpmailerException($this-&gt;Lang(&#x27;from_failed&#x27;) . $smtp_from, self::STOP_CRITICAL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Attempt to send attach all recipients</span><br><span class="line">    foreach($this-&gt;to as $to) &#123;</span><br><span class="line">      if (!$this-&gt;smtp-&gt;Recipient($to[0])) &#123;</span><br><span class="line">        $bad_rcpt[] = $to[0];</span><br><span class="line">        // implement call back function if it exists</span><br><span class="line">        $isSent = 0;</span><br><span class="line">        $this-&gt;doCallback($isSent, $to[0], &#x27;&#x27;, &#x27;&#x27;, $this-&gt;Subject, $body);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // implement call back function if it exists</span><br><span class="line">        $isSent = 1;</span><br><span class="line">        $this-&gt;doCallback($isSent, $to[0], &#x27;&#x27;, &#x27;&#x27;, $this-&gt;Subject, $body);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    foreach($this-&gt;cc as $cc) &#123;</span><br><span class="line">      if (!$this-&gt;smtp-&gt;Recipient($cc[0])) &#123;</span><br><span class="line">        $bad_rcpt[] = $cc[0];</span><br><span class="line">        // implement call back function if it exists</span><br><span class="line">        $isSent = 0;</span><br><span class="line">        $this-&gt;doCallback($isSent, &#x27;&#x27;, $cc[0], &#x27;&#x27;, $this-&gt;Subject, $body);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // implement call back function if it exists</span><br><span class="line">        $isSent = 1;</span><br><span class="line">        $this-&gt;doCallback($isSent, &#x27;&#x27;, $cc[0], &#x27;&#x27;, $this-&gt;Subject, $body);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    foreach($this-&gt;bcc as $bcc) &#123;</span><br><span class="line">      if (!$this-&gt;smtp-&gt;Recipient($bcc[0])) &#123;</span><br><span class="line">        $bad_rcpt[] = $bcc[0];</span><br><span class="line">        // implement call back function if it exists</span><br><span class="line">        $isSent = 0;</span><br><span class="line">        $this-&gt;doCallback($isSent, &#x27;&#x27;, &#x27;&#x27;, $bcc[0], $this-&gt;Subject, $body);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // implement call back function if it exists</span><br><span class="line">        $isSent = 1;</span><br><span class="line">        $this-&gt;doCallback($isSent, &#x27;&#x27;, &#x27;&#x27;, $bcc[0], $this-&gt;Subject, $body);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    if (count($bad_rcpt) &gt; 0 ) &#123; //Create error message for any bad addresses</span><br><span class="line">      $badaddresses = implode(&#x27;, &#x27;, $bad_rcpt);</span><br><span class="line">      throw new phpmailerException($this-&gt;Lang(&#x27;recipients_failed&#x27;) . $badaddresses);</span><br><span class="line">    &#125;</span><br><span class="line">    if(!$this-&gt;smtp-&gt;Data($header . $body)) &#123;</span><br><span class="line">      throw new phpmailerException($this-&gt;Lang(&#x27;data_not_accepted&#x27;), self::STOP_CRITICAL);</span><br><span class="line">    &#125;</span><br><span class="line">    if($this-&gt;SMTPKeepAlive == true) &#123;</span><br><span class="line">      $this-&gt;smtp-&gt;Reset();</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Initiates a connection to an SMTP server.</span><br><span class="line">   * Returns false if the operation failed.</span><br><span class="line">   * @uses SMTP</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function SmtpConnect() &#123;</span><br><span class="line">    if(is_null($this-&gt;smtp)) &#123;</span><br><span class="line">      $this-&gt;smtp = new SMTP();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $this-&gt;smtp-&gt;do_debug = $this-&gt;SMTPDebug;</span><br><span class="line">    $hosts = explode(&#x27;;&#x27;, $this-&gt;Host);</span><br><span class="line">    $index = 0;</span><br><span class="line">    $connection = $this-&gt;smtp-&gt;Connected();</span><br><span class="line"></span><br><span class="line">    // Retry while there is no connection</span><br><span class="line">    try &#123;</span><br><span class="line">      while($index &lt; count($hosts) &amp;&amp; !$connection) &#123;</span><br><span class="line">        $hostinfo = array();</span><br><span class="line">        if (preg_match(&#x27;/^(.+):([0-9]+)$/&#x27;, $hosts[$index], $hostinfo)) &#123;</span><br><span class="line">          $host = $hostinfo[1];</span><br><span class="line">          $port = $hostinfo[2];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          $host = $hosts[$index];</span><br><span class="line">          $port = $this-&gt;Port;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $tls = ($this-&gt;SMTPSecure == &#x27;tls&#x27;);</span><br><span class="line">        $ssl = ($this-&gt;SMTPSecure == &#x27;ssl&#x27;);</span><br><span class="line"></span><br><span class="line">        if ($this-&gt;smtp-&gt;Connect(($ssl ? &#x27;ssl://&#x27;:&#x27;&#x27;).$host, $port, $this-&gt;Timeout)) &#123;</span><br><span class="line"></span><br><span class="line">          $hello = ($this-&gt;Helo != &#x27;&#x27; ? $this-&gt;Helo : $this-&gt;ServerHostname());</span><br><span class="line">          $this-&gt;smtp-&gt;Hello($hello);</span><br><span class="line"></span><br><span class="line">          if ($tls) &#123;</span><br><span class="line">            if (!$this-&gt;smtp-&gt;StartTLS()) &#123;</span><br><span class="line">              throw new phpmailerException($this-&gt;Lang(&#x27;tls&#x27;));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            //We must resend HELO after tls negotiation</span><br><span class="line">            $this-&gt;smtp-&gt;Hello($hello);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          $connection = true;</span><br><span class="line">          if ($this-&gt;SMTPAuth) &#123;</span><br><span class="line">            if (!$this-&gt;smtp-&gt;Authenticate($this-&gt;Username, $this-&gt;Password)) &#123;</span><br><span class="line">              throw new phpmailerException($this-&gt;Lang(&#x27;authenticate&#x27;));</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        $index++;</span><br><span class="line">        if (!$connection) &#123;</span><br><span class="line">          throw new phpmailerException($this-&gt;Lang(&#x27;connect_host&#x27;));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (phpmailerException $e) &#123;</span><br><span class="line">      $this-&gt;smtp-&gt;Reset();</span><br><span class="line">      if ($this-&gt;exceptions) &#123;</span><br><span class="line">        throw $e;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Closes the active SMTP session if one exists.</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function SmtpClose() &#123;</span><br><span class="line">    if(!is_null($this-&gt;smtp)) &#123;</span><br><span class="line">      if($this-&gt;smtp-&gt;Connected()) &#123;</span><br><span class="line">        $this-&gt;smtp-&gt;Quit();</span><br><span class="line">        $this-&gt;smtp-&gt;Close();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * Sets the language for all class error messages.</span><br><span class="line">  * Returns false if it cannot load the language file.  The default language is English.</span><br><span class="line">  * @param string $langcode ISO 639-1 2-character language code (e.g. Portuguese: &quot;br&quot;)</span><br><span class="line">  * @param string $lang_path Path to the language file directory</span><br><span class="line">  * @access public</span><br><span class="line">  */</span><br><span class="line">  function SetLanguage($langcode = &#x27;en&#x27;, $lang_path = &#x27;language/&#x27;) &#123;</span><br><span class="line">    //Define full set of translatable strings</span><br><span class="line">    $PHPMAILER_LANG = array(</span><br><span class="line">      &#x27;provide_address&#x27; =&gt; &#x27;You must provide at least one recipient email address.&#x27;,</span><br><span class="line">      &#x27;mailer_not_supported&#x27; =&gt; &#x27; mailer is not supported.&#x27;,</span><br><span class="line">      &#x27;execute&#x27; =&gt; &#x27;Could not execute: &#x27;,</span><br><span class="line">      &#x27;instantiate&#x27; =&gt; &#x27;Could not instantiate mail function.&#x27;,</span><br><span class="line">      &#x27;authenticate&#x27; =&gt; &#x27;SMTP Error: Could not authenticate.&#x27;,</span><br><span class="line">      &#x27;from_failed&#x27; =&gt; &#x27;The following From address failed: &#x27;,</span><br><span class="line">      &#x27;recipients_failed&#x27; =&gt; &#x27;SMTP Error: The following recipients failed: &#x27;,</span><br><span class="line">      &#x27;data_not_accepted&#x27; =&gt; &#x27;SMTP Error: Data not accepted.&#x27;,</span><br><span class="line">      &#x27;connect_host&#x27; =&gt; &#x27;SMTP Error: Could not connect to SMTP host.&#x27;,</span><br><span class="line">      &#x27;file_access&#x27; =&gt; &#x27;Could not access file: &#x27;,</span><br><span class="line">      &#x27;file_open&#x27; =&gt; &#x27;File Error: Could not open file: &#x27;,</span><br><span class="line">      &#x27;encoding&#x27; =&gt; &#x27;Unknown encoding: &#x27;,</span><br><span class="line">      &#x27;signing&#x27; =&gt; &#x27;Signing Error: &#x27;,</span><br><span class="line">      &#x27;smtp_error&#x27; =&gt; &#x27;SMTP server error: &#x27;,</span><br><span class="line">      &#x27;empty_message&#x27; =&gt; &#x27;Message body empty&#x27;,</span><br><span class="line">      &#x27;invalid_address&#x27; =&gt; &#x27;Invalid address&#x27;,</span><br><span class="line">      &#x27;variable_set&#x27; =&gt; &#x27;Cannot set or reset variable: &#x27;</span><br><span class="line">    );</span><br><span class="line">    //Overwrite language-specific strings. This way we&#x27;ll never have missing translations - no more &quot;language string failed to load&quot;!</span><br><span class="line">    $l = true;</span><br><span class="line">    if ($langcode != &#x27;en&#x27;) &#123; //There is no English translation file</span><br><span class="line">      $l = @include $lang_path.&#x27;phpmailer.lang-&#x27;.$langcode.&#x27;.php&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    $this-&gt;language = $PHPMAILER_LANG;</span><br><span class="line">    return ($l == true); //Returns false if language not found</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * Return the current array of language strings</span><br><span class="line">  * @return array</span><br><span class="line">  */</span><br><span class="line">  public function GetTranslations() &#123;</span><br><span class="line">    return $this-&gt;language;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // METHODS, MESSAGE CREATION</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Creates recipient headers.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  public function AddrAppend($type, $addr) &#123;</span><br><span class="line">    $addr_str = $type . &#x27;: &#x27;;</span><br><span class="line">    $addresses = array();</span><br><span class="line">    foreach ($addr as $a) &#123;</span><br><span class="line">      $addresses[] = $this-&gt;AddrFormat($a);</span><br><span class="line">    &#125;</span><br><span class="line">    $addr_str .= implode(&#x27;, &#x27;, $addresses);</span><br><span class="line">    $addr_str .= $this-&gt;LE;</span><br><span class="line"></span><br><span class="line">    return $addr_str;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Formats an address correctly.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  public function AddrFormat($addr) &#123;</span><br><span class="line">    if (empty($addr[1])) &#123;</span><br><span class="line">      return $this-&gt;SecureHeader($addr[0]);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return $this-&gt;EncodeHeader($this-&gt;SecureHeader($addr[1]), &#x27;phrase&#x27;) . &quot; &lt;&quot; . $this-&gt;SecureHeader($addr[0]) . &quot;&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Wraps message for use with mailers that do not</span><br><span class="line">   * automatically perform wrapping and for quoted-printable.</span><br><span class="line">   * Original written by philippe.</span><br><span class="line">   * @param string $message The message to wrap</span><br><span class="line">   * @param integer $length The line length to wrap to</span><br><span class="line">   * @param boolean $qp_mode Whether to run in Quoted-Printable mode</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  public function WrapText($message, $length, $qp_mode = false) &#123;</span><br><span class="line">    $soft_break = ($qp_mode) ? sprintf(&quot; =%s&quot;, $this-&gt;LE) : $this-&gt;LE;</span><br><span class="line">    // If utf-8 encoding is used, we will need to make sure we don&#x27;t</span><br><span class="line">    // split multibyte characters when we wrap</span><br><span class="line">    $is_utf8 = (strtolower($this-&gt;CharSet) == &quot;utf-8&quot;);</span><br><span class="line"></span><br><span class="line">    $message = $this-&gt;FixEOL($message);</span><br><span class="line">    if (substr($message, -1) == $this-&gt;LE) &#123;</span><br><span class="line">      $message = substr($message, 0, -1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $line = explode($this-&gt;LE, $message);</span><br><span class="line">    $message = &#x27;&#x27;;</span><br><span class="line">    for ($i = 0 ;$i &lt; count($line); $i++) &#123;</span><br><span class="line">      $line_part = explode(&#x27; &#x27;, $line[$i]);</span><br><span class="line">      $buf = &#x27;&#x27;;</span><br><span class="line">      for ($e = 0; $e&lt;count($line_part); $e++) &#123;</span><br><span class="line">        $word = $line_part[$e];</span><br><span class="line">        if ($qp_mode and (strlen($word) &gt; $length)) &#123;</span><br><span class="line">          $space_left = $length - strlen($buf) - 1;</span><br><span class="line">          if ($e != 0) &#123;</span><br><span class="line">            if ($space_left &gt; 20) &#123;</span><br><span class="line">              $len = $space_left;</span><br><span class="line">              if ($is_utf8) &#123;</span><br><span class="line">                $len = $this-&gt;UTF8CharBoundary($word, $len);</span><br><span class="line">              &#125; elseif (substr($word, $len - 1, 1) == &quot;=&quot;) &#123;</span><br><span class="line">                $len--;</span><br><span class="line">              &#125; elseif (substr($word, $len - 2, 1) == &quot;=&quot;) &#123;</span><br><span class="line">                $len -= 2;</span><br><span class="line">              &#125;</span><br><span class="line">              $part = substr($word, 0, $len);</span><br><span class="line">              $word = substr($word, $len);</span><br><span class="line">              $buf .= &#x27; &#x27; . $part;</span><br><span class="line">              $message .= $buf . sprintf(&quot;=%s&quot;, $this-&gt;LE);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              $message .= $buf . $soft_break;</span><br><span class="line">            &#125;</span><br><span class="line">            $buf = &#x27;&#x27;;</span><br><span class="line">          &#125;</span><br><span class="line">          while (strlen($word) &gt; 0) &#123;</span><br><span class="line">            $len = $length;</span><br><span class="line">            if ($is_utf8) &#123;</span><br><span class="line">              $len = $this-&gt;UTF8CharBoundary($word, $len);</span><br><span class="line">            &#125; elseif (substr($word, $len - 1, 1) == &quot;=&quot;) &#123;</span><br><span class="line">              $len--;</span><br><span class="line">            &#125; elseif (substr($word, $len - 2, 1) == &quot;=&quot;) &#123;</span><br><span class="line">              $len -= 2;</span><br><span class="line">            &#125;</span><br><span class="line">            $part = substr($word, 0, $len);</span><br><span class="line">            $word = substr($word, $len);</span><br><span class="line"></span><br><span class="line">            if (strlen($word) &gt; 0) &#123;</span><br><span class="line">              $message .= $part . sprintf(&quot;=%s&quot;, $this-&gt;LE);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              $buf = $part;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          $buf_o = $buf;</span><br><span class="line">          $buf .= ($e == 0) ? $word : (&#x27; &#x27; . $word);</span><br><span class="line"></span><br><span class="line">          if (strlen($buf) &gt; $length and $buf_o != &#x27;&#x27;) &#123;</span><br><span class="line">            $message .= $buf_o . $soft_break;</span><br><span class="line">            $buf = $word;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      $message .= $buf . $this-&gt;LE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $message;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Finds last character boundary prior to maxLength in a utf-8</span><br><span class="line">   * quoted (printable) encoded string.</span><br><span class="line">   * Original written by Colin Brown.</span><br><span class="line">   * @access public</span><br><span class="line">   * @param string $encodedText utf-8 QP text</span><br><span class="line">   * @param int    $maxLength   find last character boundary prior to this length</span><br><span class="line">   * @return int</span><br><span class="line">   */</span><br><span class="line">  public function UTF8CharBoundary($encodedText, $maxLength) &#123;</span><br><span class="line">    $foundSplitPos = false;</span><br><span class="line">    $lookBack = 3;</span><br><span class="line">    while (!$foundSplitPos) &#123;</span><br><span class="line">      $lastChunk = substr($encodedText, $maxLength - $lookBack, $lookBack);</span><br><span class="line">      $encodedCharPos = strpos($lastChunk, &quot;=&quot;);</span><br><span class="line">      if ($encodedCharPos !== false) &#123;</span><br><span class="line">        // Found start of encoded character byte within $lookBack block.</span><br><span class="line">        // Check the encoded byte value (the 2 chars after the &#x27;=&#x27;)</span><br><span class="line">        $hex = substr($encodedText, $maxLength - $lookBack + $encodedCharPos + 1, 2);</span><br><span class="line">        $dec = hexdec($hex);</span><br><span class="line">        if ($dec &lt; 128) &#123; // Single byte character.</span><br><span class="line">          // If the encoded char was found at pos 0, it will fit</span><br><span class="line">          // otherwise reduce maxLength to start of the encoded char</span><br><span class="line">          $maxLength = ($encodedCharPos == 0) ? $maxLength :</span><br><span class="line">          $maxLength - ($lookBack - $encodedCharPos);</span><br><span class="line">          $foundSplitPos = true;</span><br><span class="line">        &#125; elseif ($dec &gt;= 192) &#123; // First byte of a multi byte character</span><br><span class="line">          // Reduce maxLength to split at start of character</span><br><span class="line">          $maxLength = $maxLength - ($lookBack - $encodedCharPos);</span><br><span class="line">          $foundSplitPos = true;</span><br><span class="line">        &#125; elseif ($dec &lt; 192) &#123; // Middle byte of a multi byte character, look further back</span><br><span class="line">          $lookBack += 3;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // No encoded character found</span><br><span class="line">        $foundSplitPos = true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return $maxLength;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Set the body wrapping.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function SetWordWrap() &#123;</span><br><span class="line">    if($this-&gt;WordWrap &lt; 1) &#123;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    switch($this-&gt;message_type) &#123;</span><br><span class="line">      case &#x27;alt&#x27;:</span><br><span class="line">      case &#x27;alt_inline&#x27;:</span><br><span class="line">      case &#x27;alt_attach&#x27;:</span><br><span class="line">      case &#x27;alt_inline_attach&#x27;:</span><br><span class="line">        $this-&gt;AltBody = $this-&gt;WrapText($this-&gt;AltBody, $this-&gt;WordWrap);</span><br><span class="line">        break;</span><br><span class="line">      default:</span><br><span class="line">        $this-&gt;Body = $this-&gt;WrapText($this-&gt;Body, $this-&gt;WordWrap);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Assembles message header.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string The assembled header</span><br><span class="line">   */</span><br><span class="line">  public function CreateHeader() &#123;</span><br><span class="line">    $result = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">    // Set the boundaries</span><br><span class="line">    $uniq_id = md5(uniqid(time()));</span><br><span class="line">    $this-&gt;boundary[1] = &#x27;b1_&#x27; . $uniq_id;</span><br><span class="line">    $this-&gt;boundary[2] = &#x27;b2_&#x27; . $uniq_id;</span><br><span class="line">    $this-&gt;boundary[3] = &#x27;b3_&#x27; . $uniq_id;</span><br><span class="line"></span><br><span class="line">    $result .= $this-&gt;HeaderLine(&#x27;Date&#x27;, self::RFCDate());</span><br><span class="line">    if($this-&gt;Sender == &#x27;&#x27;) &#123;</span><br><span class="line">      $result .= $this-&gt;HeaderLine(&#x27;Return-Path&#x27;, trim($this-&gt;From));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      $result .= $this-&gt;HeaderLine(&#x27;Return-Path&#x27;, trim($this-&gt;Sender));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // To be created automatically by mail()</span><br><span class="line">    if($this-&gt;Mailer != &#x27;mail&#x27;) &#123;</span><br><span class="line">      if ($this-&gt;SingleTo === true) &#123;</span><br><span class="line">        foreach($this-&gt;to as $t) &#123;</span><br><span class="line">          $this-&gt;SingleToArray[] = $this-&gt;AddrFormat($t);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        if(count($this-&gt;to) &gt; 0) &#123;</span><br><span class="line">          $result .= $this-&gt;AddrAppend(&#x27;To&#x27;, $this-&gt;to);</span><br><span class="line">        &#125; elseif (count($this-&gt;cc) == 0) &#123;</span><br><span class="line">          $result .= $this-&gt;HeaderLine(&#x27;To&#x27;, &#x27;undisclosed-recipients:;&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $from = array();</span><br><span class="line">    $from[0][0] = trim($this-&gt;From);</span><br><span class="line">    $from[0][1] = $this-&gt;FromName;</span><br><span class="line">    $result .= $this-&gt;AddrAppend(&#x27;From&#x27;, $from);</span><br><span class="line"></span><br><span class="line">    // sendmail and mail() extract Cc from the header before sending</span><br><span class="line">    if(count($this-&gt;cc) &gt; 0) &#123;</span><br><span class="line">      $result .= $this-&gt;AddrAppend(&#x27;Cc&#x27;, $this-&gt;cc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // sendmail and mail() extract Bcc from the header before sending</span><br><span class="line">    if((($this-&gt;Mailer == &#x27;sendmail&#x27;) || ($this-&gt;Mailer == &#x27;mail&#x27;)) &amp;&amp; (count($this-&gt;bcc) &gt; 0)) &#123;</span><br><span class="line">      $result .= $this-&gt;AddrAppend(&#x27;Bcc&#x27;, $this-&gt;bcc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(count($this-&gt;ReplyTo) &gt; 0) &#123;</span><br><span class="line">      $result .= $this-&gt;AddrAppend(&#x27;Reply-To&#x27;, $this-&gt;ReplyTo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // mail() sets the subject itself</span><br><span class="line">    if($this-&gt;Mailer != &#x27;mail&#x27;) &#123;</span><br><span class="line">      $result .= $this-&gt;HeaderLine(&#x27;Subject&#x27;, $this-&gt;EncodeHeader($this-&gt;SecureHeader($this-&gt;Subject)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if($this-&gt;MessageID != &#x27;&#x27;) &#123;</span><br><span class="line">      $result .= $this-&gt;HeaderLine(&#x27;Message-ID&#x27;, $this-&gt;MessageID);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      $result .= sprintf(&quot;Message-ID: &lt;%s@%s&gt;%s&quot;, $uniq_id, $this-&gt;ServerHostname(), $this-&gt;LE);</span><br><span class="line">    &#125;</span><br><span class="line">    $result .= $this-&gt;HeaderLine(&#x27;X-Priority&#x27;, $this-&gt;Priority);</span><br><span class="line">    if($this-&gt;XMailer) &#123;</span><br><span class="line">      $result .= $this-&gt;HeaderLine(&#x27;X-Mailer&#x27;, $this-&gt;XMailer);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      $result .= $this-&gt;HeaderLine(&#x27;X-Mailer&#x27;, &#x27;PHPMailer &#x27;.$this-&gt;Version.&#x27; (http://code.google.com/a/apache-extras.org/p/phpmailer/)&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if($this-&gt;ConfirmReadingTo != &#x27;&#x27;) &#123;</span><br><span class="line">      $result .= $this-&gt;HeaderLine(&#x27;Disposition-Notification-To&#x27;, &#x27;&lt;&#x27; . trim($this-&gt;ConfirmReadingTo) . &#x27;&gt;&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Add custom headers</span><br><span class="line">    for($index = 0; $index &lt; count($this-&gt;CustomHeader); $index++) &#123;</span><br><span class="line">      $result .= $this-&gt;HeaderLine(trim($this-&gt;CustomHeader[$index][0]), $this-&gt;EncodeHeader(trim($this-&gt;CustomHeader[$index][1])));</span><br><span class="line">    &#125;</span><br><span class="line">    if (!$this-&gt;sign_key_file) &#123;</span><br><span class="line">      $result .= $this-&gt;HeaderLine(&#x27;MIME-Version&#x27;, &#x27;1.0&#x27;);</span><br><span class="line">      $result .= $this-&gt;GetMailMIME();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Returns the message MIME.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  public function GetMailMIME() &#123;</span><br><span class="line">    $result = &#x27;&#x27;;</span><br><span class="line">    switch($this-&gt;message_type) &#123;</span><br><span class="line">      case &#x27;plain&#x27;:</span><br><span class="line">        $result .= $this-&gt;HeaderLine(&#x27;Content-Transfer-Encoding&#x27;, $this-&gt;Encoding);</span><br><span class="line">        $result .= $this-&gt;TextLine(&#x27;Content-Type: &#x27;.$this-&gt;ContentType.&#x27;; charset=&quot;&#x27;.$this-&gt;CharSet.&#x27;&quot;&#x27;);</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;inline&#x27;:</span><br><span class="line">        $result .= $this-&gt;HeaderLine(&#x27;Content-Type&#x27;, &#x27;multipart/related;&#x27;);</span><br><span class="line">        $result .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . &#x27;&quot;&#x27;);</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;attach&#x27;:</span><br><span class="line">      case &#x27;inline_attach&#x27;:</span><br><span class="line">      case &#x27;alt_attach&#x27;:</span><br><span class="line">      case &#x27;alt_inline_attach&#x27;:</span><br><span class="line">        $result .= $this-&gt;HeaderLine(&#x27;Content-Type&#x27;, &#x27;multipart/mixed;&#x27;);</span><br><span class="line">        $result .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . &#x27;&quot;&#x27;);</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;alt&#x27;:</span><br><span class="line">      case &#x27;alt_inline&#x27;:</span><br><span class="line">        $result .= $this-&gt;HeaderLine(&#x27;Content-Type&#x27;, &#x27;multipart/alternative;&#x27;);</span><br><span class="line">        $result .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . &#x27;&quot;&#x27;);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if($this-&gt;Mailer != &#x27;mail&#x27;) &#123;</span><br><span class="line">      $result .= $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Returns the MIME message (headers and body). Only really valid post PreSend().</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  public function GetSentMIMEMessage() &#123;</span><br><span class="line">    return $this-&gt;SentMIMEMessage;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Assembles the message body.  Returns an empty string on failure.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string The assembled message body</span><br><span class="line">   */</span><br><span class="line">  public function CreateBody() &#123;</span><br><span class="line">    $body = &#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">    if ($this-&gt;sign_key_file) &#123;</span><br><span class="line">      $body .= $this-&gt;GetMailMIME();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $this-&gt;SetWordWrap();</span><br><span class="line"></span><br><span class="line">    switch($this-&gt;message_type) &#123;</span><br><span class="line">      case &#x27;plain&#x27;:</span><br><span class="line">        $body .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;inline&#x27;:</span><br><span class="line">        $body .= $this-&gt;GetBoundary($this-&gt;boundary[1], &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;);</span><br><span class="line">        $body .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);</span><br><span class="line">        $body .= $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;AttachAll(&quot;inline&quot;, $this-&gt;boundary[1]);</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;attach&#x27;:</span><br><span class="line">        $body .= $this-&gt;GetBoundary($this-&gt;boundary[1], &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;);</span><br><span class="line">        $body .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);</span><br><span class="line">        $body .= $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;AttachAll(&quot;attachment&quot;, $this-&gt;boundary[1]);</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;inline_attach&#x27;:</span><br><span class="line">        $body .= $this-&gt;TextLine(&quot;--&quot; . $this-&gt;boundary[1]);</span><br><span class="line">        $body .= $this-&gt;HeaderLine(&#x27;Content-Type&#x27;, &#x27;multipart/related;&#x27;);</span><br><span class="line">        $body .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[2] . &#x27;&quot;&#x27;);</span><br><span class="line">        $body .= $this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;GetBoundary($this-&gt;boundary[2], &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;);</span><br><span class="line">        $body .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);</span><br><span class="line">        $body .= $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;AttachAll(&quot;inline&quot;, $this-&gt;boundary[2]);</span><br><span class="line">        $body .= $this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;AttachAll(&quot;attachment&quot;, $this-&gt;boundary[1]);</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;alt&#x27;:</span><br><span class="line">        $body .= $this-&gt;GetBoundary($this-&gt;boundary[1], &#x27;&#x27;, &#x27;text/plain&#x27;, &#x27;&#x27;);</span><br><span class="line">        $body .= $this-&gt;EncodeString($this-&gt;AltBody, $this-&gt;Encoding);</span><br><span class="line">        $body .= $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;GetBoundary($this-&gt;boundary[1], &#x27;&#x27;, &#x27;text/html&#x27;, &#x27;&#x27;);</span><br><span class="line">        $body .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);</span><br><span class="line">        $body .= $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;EndBoundary($this-&gt;boundary[1]);</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;alt_inline&#x27;:</span><br><span class="line">        $body .= $this-&gt;GetBoundary($this-&gt;boundary[1], &#x27;&#x27;, &#x27;text/plain&#x27;, &#x27;&#x27;);</span><br><span class="line">        $body .= $this-&gt;EncodeString($this-&gt;AltBody, $this-&gt;Encoding);</span><br><span class="line">        $body .= $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;TextLine(&quot;--&quot; . $this-&gt;boundary[1]);</span><br><span class="line">        $body .= $this-&gt;HeaderLine(&#x27;Content-Type&#x27;, &#x27;multipart/related;&#x27;);</span><br><span class="line">        $body .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[2] . &#x27;&quot;&#x27;);</span><br><span class="line">        $body .= $this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;GetBoundary($this-&gt;boundary[2], &#x27;&#x27;, &#x27;text/html&#x27;, &#x27;&#x27;);</span><br><span class="line">        $body .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);</span><br><span class="line">        $body .= $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;AttachAll(&quot;inline&quot;, $this-&gt;boundary[2]);</span><br><span class="line">        $body .= $this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;EndBoundary($this-&gt;boundary[1]);</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;alt_attach&#x27;:</span><br><span class="line">        $body .= $this-&gt;TextLine(&quot;--&quot; . $this-&gt;boundary[1]);</span><br><span class="line">        $body .= $this-&gt;HeaderLine(&#x27;Content-Type&#x27;, &#x27;multipart/alternative;&#x27;);</span><br><span class="line">        $body .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[2] . &#x27;&quot;&#x27;);</span><br><span class="line">        $body .= $this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;GetBoundary($this-&gt;boundary[2], &#x27;&#x27;, &#x27;text/plain&#x27;, &#x27;&#x27;);</span><br><span class="line">        $body .= $this-&gt;EncodeString($this-&gt;AltBody, $this-&gt;Encoding);</span><br><span class="line">        $body .= $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;GetBoundary($this-&gt;boundary[2], &#x27;&#x27;, &#x27;text/html&#x27;, &#x27;&#x27;);</span><br><span class="line">        $body .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);</span><br><span class="line">        $body .= $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;EndBoundary($this-&gt;boundary[2]);</span><br><span class="line">        $body .= $this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;AttachAll(&quot;attachment&quot;, $this-&gt;boundary[1]);</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;alt_inline_attach&#x27;:</span><br><span class="line">        $body .= $this-&gt;TextLine(&quot;--&quot; . $this-&gt;boundary[1]);</span><br><span class="line">        $body .= $this-&gt;HeaderLine(&#x27;Content-Type&#x27;, &#x27;multipart/alternative;&#x27;);</span><br><span class="line">        $body .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[2] . &#x27;&quot;&#x27;);</span><br><span class="line">        $body .= $this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;GetBoundary($this-&gt;boundary[2], &#x27;&#x27;, &#x27;text/plain&#x27;, &#x27;&#x27;);</span><br><span class="line">        $body .= $this-&gt;EncodeString($this-&gt;AltBody, $this-&gt;Encoding);</span><br><span class="line">        $body .= $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;TextLine(&quot;--&quot; . $this-&gt;boundary[2]);</span><br><span class="line">        $body .= $this-&gt;HeaderLine(&#x27;Content-Type&#x27;, &#x27;multipart/related;&#x27;);</span><br><span class="line">        $body .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[3] . &#x27;&quot;&#x27;);</span><br><span class="line">        $body .= $this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;GetBoundary($this-&gt;boundary[3], &#x27;&#x27;, &#x27;text/html&#x27;, &#x27;&#x27;);</span><br><span class="line">        $body .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);</span><br><span class="line">        $body .= $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;AttachAll(&quot;inline&quot;, $this-&gt;boundary[3]);</span><br><span class="line">        $body .= $this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;EndBoundary($this-&gt;boundary[2]);</span><br><span class="line">        $body .= $this-&gt;LE;</span><br><span class="line">        $body .= $this-&gt;AttachAll(&quot;attachment&quot;, $this-&gt;boundary[1]);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if ($this-&gt;IsError()) &#123;</span><br><span class="line">      $body = &#x27;&#x27;;</span><br><span class="line">    &#125; elseif ($this-&gt;sign_key_file) &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        $file = tempnam(&#x27;&#x27;, &#x27;mail&#x27;);</span><br><span class="line">        file_put_contents($file, $body); //TODO check this worked</span><br><span class="line">        $signed = tempnam(&quot;&quot;, &quot;signed&quot;);</span><br><span class="line">        if (@openssl_pkcs7_sign($file, $signed, &quot;file://&quot;.$this-&gt;sign_cert_file, array(&quot;file://&quot;.$this-&gt;sign_key_file, $this-&gt;sign_key_pass), NULL)) &#123;</span><br><span class="line">          @unlink($file);</span><br><span class="line">          $body = file_get_contents($signed);</span><br><span class="line">          @unlink($signed);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          @unlink($file);</span><br><span class="line">          @unlink($signed);</span><br><span class="line">          throw new phpmailerException($this-&gt;Lang(&quot;signing&quot;).openssl_error_string());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; catch (phpmailerException $e) &#123;</span><br><span class="line">        $body = &#x27;&#x27;;</span><br><span class="line">        if ($this-&gt;exceptions) &#123;</span><br><span class="line">          throw $e;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $body;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Returns the start of a message boundary.</span><br><span class="line">   * @access protected</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  protected function GetBoundary($boundary, $charSet, $contentType, $encoding) &#123;</span><br><span class="line">    $result = &#x27;&#x27;;</span><br><span class="line">    if($charSet == &#x27;&#x27;) &#123;</span><br><span class="line">      $charSet = $this-&gt;CharSet;</span><br><span class="line">    &#125;</span><br><span class="line">    if($contentType == &#x27;&#x27;) &#123;</span><br><span class="line">      $contentType = $this-&gt;ContentType;</span><br><span class="line">    &#125;</span><br><span class="line">    if($encoding == &#x27;&#x27;) &#123;</span><br><span class="line">      $encoding = $this-&gt;Encoding;</span><br><span class="line">    &#125;</span><br><span class="line">    $result .= $this-&gt;TextLine(&#x27;--&#x27; . $boundary);</span><br><span class="line">    $result .= sprintf(&quot;Content-Type: %s; charset=\&quot;%s\&quot;&quot;, $contentType, $charSet);</span><br><span class="line">    $result .= $this-&gt;LE;</span><br><span class="line">    $result .= $this-&gt;HeaderLine(&#x27;Content-Transfer-Encoding&#x27;, $encoding);</span><br><span class="line">    $result .= $this-&gt;LE;</span><br><span class="line"></span><br><span class="line">    return $result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Returns the end of a message boundary.</span><br><span class="line">   * @access protected</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  protected function EndBoundary($boundary) &#123;</span><br><span class="line">    return $this-&gt;LE . &#x27;--&#x27; . $boundary . &#x27;--&#x27; . $this-&gt;LE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the message type.</span><br><span class="line">   * @access protected</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  protected function SetMessageType() &#123;</span><br><span class="line">    $this-&gt;message_type = array();</span><br><span class="line">    if($this-&gt;AlternativeExists()) $this-&gt;message_type[] = &quot;alt&quot;;</span><br><span class="line">    if($this-&gt;InlineImageExists()) $this-&gt;message_type[] = &quot;inline&quot;;</span><br><span class="line">    if($this-&gt;AttachmentExists()) $this-&gt;message_type[] = &quot;attach&quot;;</span><br><span class="line">    $this-&gt;message_type = implode(&quot;_&quot;, $this-&gt;message_type);</span><br><span class="line">    if($this-&gt;message_type == &quot;&quot;) $this-&gt;message_type = &quot;plain&quot;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   *  Returns a formatted header line.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  public function HeaderLine($name, $value) &#123;</span><br><span class="line">    return $name . &#x27;: &#x27; . $value . $this-&gt;LE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Returns a formatted mail line.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  public function TextLine($value) &#123;</span><br><span class="line">    return $value . $this-&gt;LE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // CLASS METHODS, ATTACHMENTS</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Adds an attachment from a path on the filesystem.</span><br><span class="line">   * Returns false if the file could not be found</span><br><span class="line">   * or accessed.</span><br><span class="line">   * @param string $path Path to the attachment.</span><br><span class="line">   * @param string $name Overrides the attachment name.</span><br><span class="line">   * @param string $encoding File encoding (see $Encoding).</span><br><span class="line">   * @param string $type File extension (MIME) type.</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function AddAttachment($path, $name = &#x27;&#x27;, $encoding = &#x27;base64&#x27;, $type = &#x27;application/octet-stream&#x27;) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      if ( !@is_file($path) ) &#123;</span><br><span class="line">        throw new phpmailerException($this-&gt;Lang(&#x27;file_access&#x27;) . $path, self::STOP_CONTINUE);</span><br><span class="line">      &#125;</span><br><span class="line">      $filename = basename($path);</span><br><span class="line">      if ( $name == &#x27;&#x27; ) &#123;</span><br><span class="line">        $name = $filename;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      $this-&gt;attachment[] = array(</span><br><span class="line">        0 =&gt; $path,</span><br><span class="line">        1 =&gt; $filename,</span><br><span class="line">        2 =&gt; $name,</span><br><span class="line">        3 =&gt; $encoding,</span><br><span class="line">        4 =&gt; $type,</span><br><span class="line">        5 =&gt; false,  // isStringAttachment</span><br><span class="line">        6 =&gt; &#x27;attachment&#x27;,</span><br><span class="line">        7 =&gt; 0</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">    &#125; catch (phpmailerException $e) &#123;</span><br><span class="line">      $this-&gt;SetError($e-&gt;getMessage());</span><br><span class="line">      if ($this-&gt;exceptions) &#123;</span><br><span class="line">        throw $e;</span><br><span class="line">      &#125;</span><br><span class="line">      if ($this-&gt;SMTPDebug) &#123;</span><br><span class="line">        echo $e-&gt;getMessage().&quot;\n&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">      if ( $e-&gt;getCode() == self::STOP_CRITICAL ) &#123;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * Return the current array of attachments</span><br><span class="line">  * @return array</span><br><span class="line">  */</span><br><span class="line">  public function GetAttachments() &#123;</span><br><span class="line">    return $this-&gt;attachment;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Attaches all fs, string, and binary attachments to the message.</span><br><span class="line">   * Returns an empty string on failure.</span><br><span class="line">   * @access protected</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  protected function AttachAll($disposition_type, $boundary) &#123;</span><br><span class="line">    // Return text of body</span><br><span class="line">    $mime = array();</span><br><span class="line">    $cidUniq = array();</span><br><span class="line">    $incl = array();</span><br><span class="line"></span><br><span class="line">    // Add all attachments</span><br><span class="line">    foreach ($this-&gt;attachment as $attachment) &#123;</span><br><span class="line">      // CHECK IF IT IS A VALID DISPOSITION_FILTER</span><br><span class="line">      if($attachment[6] == $disposition_type) &#123;</span><br><span class="line">        // Check for string attachment</span><br><span class="line">        $bString = $attachment[5];</span><br><span class="line">        if ($bString) &#123;</span><br><span class="line">          $string = $attachment[0];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          $path = $attachment[0];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $inclhash = md5(serialize($attachment));</span><br><span class="line">        if (in_array($inclhash, $incl)) &#123; continue; &#125;</span><br><span class="line">        $incl[]      = $inclhash;</span><br><span class="line">        $filename    = $attachment[1];</span><br><span class="line">        $name        = $attachment[2];</span><br><span class="line">        $encoding    = $attachment[3];</span><br><span class="line">        $type        = $attachment[4];</span><br><span class="line">        $disposition = $attachment[6];</span><br><span class="line">        $cid         = $attachment[7];</span><br><span class="line">        if ( $disposition == &#x27;inline&#x27; &amp;&amp; isset($cidUniq[$cid]) ) &#123; continue; &#125;</span><br><span class="line">        $cidUniq[$cid] = true;</span><br><span class="line"></span><br><span class="line">        $mime[] = sprintf(&quot;--%s%s&quot;, $boundary, $this-&gt;LE);</span><br><span class="line">        $mime[] = sprintf(&quot;Content-Type: %s; name=\&quot;%s\&quot;%s&quot;, $type, $this-&gt;EncodeHeader($this-&gt;SecureHeader($name)), $this-&gt;LE);</span><br><span class="line">        $mime[] = sprintf(&quot;Content-Transfer-Encoding: %s%s&quot;, $encoding, $this-&gt;LE);</span><br><span class="line"></span><br><span class="line">        if($disposition == &#x27;inline&#x27;) &#123;</span><br><span class="line">          $mime[] = sprintf(&quot;Content-ID: &lt;%s&gt;%s&quot;, $cid, $this-&gt;LE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $mime[] = sprintf(&quot;Content-Disposition: %s; filename=\&quot;%s\&quot;%s&quot;, $disposition, $this-&gt;EncodeHeader($this-&gt;SecureHeader($name)), $this-&gt;LE.$this-&gt;LE);</span><br><span class="line"></span><br><span class="line">        // Encode as string attachment</span><br><span class="line">        if($bString) &#123;</span><br><span class="line">          $mime[] = $this-&gt;EncodeString($string, $encoding);</span><br><span class="line">          if($this-&gt;IsError()) &#123;</span><br><span class="line">            return &#x27;&#x27;;</span><br><span class="line">          &#125;</span><br><span class="line">          $mime[] = $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          $mime[] = $this-&gt;EncodeFile($path, $encoding);</span><br><span class="line">          if($this-&gt;IsError()) &#123;</span><br><span class="line">            return &#x27;&#x27;;</span><br><span class="line">          &#125;</span><br><span class="line">          $mime[] = $this-&gt;LE.$this-&gt;LE;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $mime[] = sprintf(&quot;--%s--%s&quot;, $boundary, $this-&gt;LE);</span><br><span class="line"></span><br><span class="line">    return implode(&quot;&quot;, $mime);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Encodes attachment in requested format.</span><br><span class="line">   * Returns an empty string on failure.</span><br><span class="line">   * @param string $path The full path to the file</span><br><span class="line">   * @param string $encoding The encoding to use; one of &#x27;base64&#x27;, &#x27;7bit&#x27;, &#x27;8bit&#x27;, &#x27;binary&#x27;, &#x27;quoted-printable&#x27;</span><br><span class="line">   * @see EncodeFile()</span><br><span class="line">   * @access protected</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  protected function EncodeFile($path, $encoding = &#x27;base64&#x27;) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      if (!is_readable($path)) &#123;</span><br><span class="line">        throw new phpmailerException($this-&gt;Lang(&#x27;file_open&#x27;) . $path, self::STOP_CONTINUE);</span><br><span class="line">      &#125;</span><br><span class="line">      if (function_exists(&#x27;get_magic_quotes&#x27;)) &#123;</span><br><span class="line">        function get_magic_quotes() &#123;</span><br><span class="line">          return false;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      $magic_quotes = get_magic_quotes_runtime();</span><br><span class="line">      if ($magic_quotes) &#123;</span><br><span class="line">        if (version_compare(PHP_VERSION, &#x27;5.3.0&#x27;, &#x27;&lt;&#x27;)) &#123;</span><br><span class="line">          set_magic_quotes_runtime(0);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          ini_set(&#x27;magic_quotes_runtime&#x27;, 0); </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      $file_buffer  = file_get_contents($path);</span><br><span class="line">      $file_buffer  = $this-&gt;EncodeString($file_buffer, $encoding);</span><br><span class="line">      if ($magic_quotes) &#123;</span><br><span class="line">        if (version_compare(PHP_VERSION, &#x27;5.3.0&#x27;, &#x27;&lt;&#x27;)) &#123;</span><br><span class="line">          set_magic_quotes_runtime($magic_quotes);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          ini_set(&#x27;magic_quotes_runtime&#x27;, $magic_quotes); </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      return $file_buffer;</span><br><span class="line">    &#125; catch (Exception $e) &#123;</span><br><span class="line">      $this-&gt;SetError($e-&gt;getMessage());</span><br><span class="line">      return &#x27;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Encodes string to requested format.</span><br><span class="line">   * Returns an empty string on failure.</span><br><span class="line">   * @param string $str The text to encode</span><br><span class="line">   * @param string $encoding The encoding to use; one of &#x27;base64&#x27;, &#x27;7bit&#x27;, &#x27;8bit&#x27;, &#x27;binary&#x27;, &#x27;quoted-printable&#x27;</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  public function EncodeString($str, $encoding = &#x27;base64&#x27;) &#123;</span><br><span class="line">    $encoded = &#x27;&#x27;;</span><br><span class="line">    switch(strtolower($encoding)) &#123;</span><br><span class="line">      case &#x27;base64&#x27;:</span><br><span class="line">        $encoded = chunk_split(base64_encode($str), 76, $this-&gt;LE);</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;7bit&#x27;:</span><br><span class="line">      case &#x27;8bit&#x27;:</span><br><span class="line">        $encoded = $this-&gt;FixEOL($str);</span><br><span class="line">        //Make sure it ends with a line break</span><br><span class="line">        if (substr($encoded, -(strlen($this-&gt;LE))) != $this-&gt;LE)</span><br><span class="line">          $encoded .= $this-&gt;LE;</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;binary&#x27;:</span><br><span class="line">        $encoded = $str;</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;quoted-printable&#x27;:</span><br><span class="line">        $encoded = $this-&gt;EncodeQP($str);</span><br><span class="line">        break;</span><br><span class="line">      default:</span><br><span class="line">        $this-&gt;SetError($this-&gt;Lang(&#x27;encoding&#x27;) . $encoding);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">    return $encoded;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Encode a header string to best (shortest) of Q, B, quoted or none.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  public function EncodeHeader($str, $position = &#x27;text&#x27;) &#123;</span><br><span class="line">    $x = 0;</span><br><span class="line"></span><br><span class="line">    switch (strtolower($position)) &#123;</span><br><span class="line">      case &#x27;phrase&#x27;:</span><br><span class="line">        if (!preg_match(&#x27;/[\200-\377]/&#x27;, $str)) &#123;</span><br><span class="line">          // Can&#x27;t use addslashes as we don&#x27;t know what value has magic_quotes_sybase</span><br><span class="line">          $encoded = addcslashes($str, &quot;\0..\37\177\\\&quot;&quot;);</span><br><span class="line">          if (($str == $encoded) &amp;&amp; !preg_match(&#x27;/[^A-Za-z0-9!#$%&amp;\&#x27;*+\/=?^_`&#123;|&#125;~ -]/&#x27;, $str)) &#123;</span><br><span class="line">            return ($encoded);</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            return (&quot;\&quot;$encoded\&quot;&quot;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        $x = preg_match_all(&#x27;/[^\040\041\043-\133\135-\176]/&#x27;, $str, $matches);</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;comment&#x27;:</span><br><span class="line">        $x = preg_match_all(&#x27;/[()&quot;]/&#x27;, $str, $matches);</span><br><span class="line">        // Fall-through</span><br><span class="line">      case &#x27;text&#x27;:</span><br><span class="line">      default:</span><br><span class="line">        $x += preg_match_all(&#x27;/[\000-\010\013\014\016-\037\177-\377]/&#x27;, $str, $matches);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if ($x == 0) &#123;</span><br><span class="line">      return ($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $maxlen = 75 - 7 - strlen($this-&gt;CharSet);</span><br><span class="line">    // Try to select the encoding which should produce the shortest output</span><br><span class="line">    if (strlen($str)/3 &lt; $x) &#123;</span><br><span class="line">      $encoding = &#x27;B&#x27;;</span><br><span class="line">      if (function_exists(&#x27;mb_strlen&#x27;) &amp;&amp; $this-&gt;HasMultiBytes($str)) &#123;</span><br><span class="line">        // Use a custom function which correctly encodes and wraps long</span><br><span class="line">        // multibyte strings without breaking lines within a character</span><br><span class="line">        $encoded = $this-&gt;Base64EncodeWrapMB($str);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        $encoded = base64_encode($str);</span><br><span class="line">        $maxlen -= $maxlen % 4;</span><br><span class="line">        $encoded = trim(chunk_split($encoded, $maxlen, &quot;\n&quot;));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      $encoding = &#x27;Q&#x27;;</span><br><span class="line">      $encoded = $this-&gt;EncodeQ($str, $position);</span><br><span class="line">      $encoded = $this-&gt;WrapText($encoded, $maxlen, true);</span><br><span class="line">      $encoded = str_replace(&#x27;=&#x27;.$this-&gt;LE, &quot;\n&quot;, trim($encoded));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $encoded = preg_replace(&#x27;/^(.*)$/m&#x27;, &quot; =?&quot;.$this-&gt;CharSet.&quot;?$encoding?\\1?=&quot;, $encoded);</span><br><span class="line">    $encoded = trim(str_replace(&quot;\n&quot;, $this-&gt;LE, $encoded));</span><br><span class="line"></span><br><span class="line">    return $encoded;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Checks if a string contains multibyte characters.</span><br><span class="line">   * @access public</span><br><span class="line">   * @param string $str multi-byte text to wrap encode</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function HasMultiBytes($str) &#123;</span><br><span class="line">    if (function_exists(&#x27;mb_strlen&#x27;)) &#123;</span><br><span class="line">      return (strlen($str) &gt; mb_strlen($str, $this-&gt;CharSet));</span><br><span class="line">    &#125; else &#123; // Assume no multibytes (we can&#x27;t handle without mbstring functions anyway)</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Correctly encodes and wraps long multibyte strings for mail headers</span><br><span class="line">   * without breaking lines within a character.</span><br><span class="line">   * Adapted from a function by paravoid at http://uk.php.net/manual/en/function.mb-encode-mimeheader.php</span><br><span class="line">   * @access public</span><br><span class="line">   * @param string $str multi-byte text to wrap encode</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  public function Base64EncodeWrapMB($str) &#123;</span><br><span class="line">    $start = &quot;=?&quot;.$this-&gt;CharSet.&quot;?B?&quot;;</span><br><span class="line">    $end = &quot;?=&quot;;</span><br><span class="line">    $encoded = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">    $mb_length = mb_strlen($str, $this-&gt;CharSet);</span><br><span class="line">    // Each line must have length &lt;= 75, including $start and $end</span><br><span class="line">    $length = 75 - strlen($start) - strlen($end);</span><br><span class="line">    // Average multi-byte ratio</span><br><span class="line">    $ratio = $mb_length / strlen($str);</span><br><span class="line">    // Base64 has a 4:3 ratio</span><br><span class="line">    $offset = $avgLength = floor($length * $ratio * .75);</span><br><span class="line"></span><br><span class="line">    for ($i = 0; $i &lt; $mb_length; $i += $offset) &#123;</span><br><span class="line">      $lookBack = 0;</span><br><span class="line"></span><br><span class="line">      do &#123;</span><br><span class="line">        $offset = $avgLength - $lookBack;</span><br><span class="line">        $chunk = mb_substr($str, $i, $offset, $this-&gt;CharSet);</span><br><span class="line">        $chunk = base64_encode($chunk);</span><br><span class="line">        $lookBack++;</span><br><span class="line">      &#125;</span><br><span class="line">      while (strlen($chunk) &gt; $length);</span><br><span class="line"></span><br><span class="line">      $encoded .= $chunk . $this-&gt;LE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Chomp the last linefeed</span><br><span class="line">    $encoded = substr($encoded, 0, -strlen($this-&gt;LE));</span><br><span class="line">    return $encoded;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * Encode string to quoted-printable.</span><br><span class="line">  * Only uses standard PHP, slow, but will always work</span><br><span class="line">  * @access public</span><br><span class="line">  * @param string $string the text to encode</span><br><span class="line">  * @param integer $line_max Number of chars allowed on a line before wrapping</span><br><span class="line">  * @return string</span><br><span class="line">  */</span><br><span class="line">  public function EncodeQPphp( $input = &#x27;&#x27;, $line_max = 76, $space_conv = false) &#123;</span><br><span class="line">    $hex = array(&#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;, &#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;);</span><br><span class="line">    $lines = preg_split(&#x27;/(?:\r\n|\r|\n)/&#x27;, $input);</span><br><span class="line">    $eol = &quot;\r\n&quot;;</span><br><span class="line">    $escape = &#x27;=&#x27;;</span><br><span class="line">    $output = &#x27;&#x27;;</span><br><span class="line">    while( list(, $line) = each($lines) ) &#123;</span><br><span class="line">      $linlen = strlen($line);</span><br><span class="line">      $newline = &#x27;&#x27;;</span><br><span class="line">      for($i = 0; $i &lt; $linlen; $i++) &#123;</span><br><span class="line">        $c = substr( $line, $i, 1 );</span><br><span class="line">        $dec = ord( $c );</span><br><span class="line">        if ( ( $i == 0 ) &amp;&amp; ( $dec == 46 ) ) &#123; // convert first point in the line into =2E</span><br><span class="line">          $c = &#x27;=2E&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">        if ( $dec == 32 ) &#123;</span><br><span class="line">          if ( $i == ( $linlen - 1 ) ) &#123; // convert space at eol only</span><br><span class="line">            $c = &#x27;=20&#x27;;</span><br><span class="line">          &#125; else if ( $space_conv ) &#123;</span><br><span class="line">            $c = &#x27;=20&#x27;;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; elseif ( ($dec == 61) || ($dec &lt; 32 ) || ($dec &gt; 126) ) &#123; // always encode &quot;\t&quot;, which is *not* required</span><br><span class="line">          $h2 = floor($dec/16);</span><br><span class="line">          $h1 = floor($dec%16);</span><br><span class="line">          $c = $escape.$hex[$h2].$hex[$h1];</span><br><span class="line">        &#125;</span><br><span class="line">        if ( (strlen($newline) + strlen($c)) &gt;= $line_max ) &#123; // CRLF is not counted</span><br><span class="line">          $output .= $newline.$escape.$eol; //  soft line break; &quot; =\r\n&quot; is okay</span><br><span class="line">          $newline = &#x27;&#x27;;</span><br><span class="line">          // check if newline first character will be point or not</span><br><span class="line">          if ( $dec == 46 ) &#123;</span><br><span class="line">            $c = &#x27;=2E&#x27;;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        $newline .= $c;</span><br><span class="line">      &#125; // end of for</span><br><span class="line">      $output .= $newline.$eol;</span><br><span class="line">    &#125; // end of while</span><br><span class="line">    return $output;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * Encode string to RFC2045 (6.7) quoted-printable format</span><br><span class="line">  * Uses a PHP5 stream filter to do the encoding about 64x faster than the old version</span><br><span class="line">  * Also results in same content as you started with after decoding</span><br><span class="line">  * @see EncodeQPphp()</span><br><span class="line">  * @access public</span><br><span class="line">  * @param string $string the text to encode</span><br><span class="line">  * @param integer $line_max Number of chars allowed on a line before wrapping</span><br><span class="line">  * @param boolean $space_conv Dummy param for compatibility with existing EncodeQP function</span><br><span class="line">  * @return string</span><br><span class="line">  * @author Marcus Bointon</span><br><span class="line">  */</span><br><span class="line">  public function EncodeQP($string, $line_max = 76, $space_conv = false) &#123;</span><br><span class="line">    if (function_exists(&#x27;quoted_printable_encode&#x27;)) &#123; //Use native function if it&#x27;s available (&gt;= PHP5.3)</span><br><span class="line">      return quoted_printable_encode($string);</span><br><span class="line">    &#125;</span><br><span class="line">    $filters = stream_get_filters();</span><br><span class="line">    if (!in_array(&#x27;convert.*&#x27;, $filters)) &#123; //Got convert stream filter?</span><br><span class="line">      return $this-&gt;EncodeQPphp($string, $line_max, $space_conv); //Fall back to old implementation</span><br><span class="line">    &#125;</span><br><span class="line">    $fp = fopen(&#x27;php://temp/&#x27;, &#x27;r+&#x27;);</span><br><span class="line">    $string = preg_replace(&#x27;/\r\n?/&#x27;, $this-&gt;LE, $string); //Normalise line breaks</span><br><span class="line">    $params = array(&#x27;line-length&#x27; =&gt; $line_max, &#x27;line-break-chars&#x27; =&gt; $this-&gt;LE);</span><br><span class="line">    $s = stream_filter_append($fp, &#x27;convert.quoted-printable-encode&#x27;, STREAM_FILTER_READ, $params);</span><br><span class="line">    fputs($fp, $string);</span><br><span class="line">    rewind($fp);</span><br><span class="line">    $out = stream_get_contents($fp);</span><br><span class="line">    stream_filter_remove($s);</span><br><span class="line">    $out = preg_replace(&#x27;/^\./m&#x27;, &#x27;=2E&#x27;, $out); //Encode . if it is first char on a line, workaround for bug in Exchange</span><br><span class="line">    fclose($fp);</span><br><span class="line">    return $out;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Encode string to q encoding.</span><br><span class="line">   * @link http://tools.ietf.org/html/rfc2047</span><br><span class="line">   * @param string $str the text to encode</span><br><span class="line">   * @param string $position Where the text is going to be used, see the RFC for what that means</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  public function EncodeQ($str, $position = &#x27;text&#x27;) &#123;</span><br><span class="line">    // There should not be any EOL in the string</span><br><span class="line">    $encoded = preg_replace(&#x27;/[\r\n]*/&#x27;, &#x27;&#x27;, $str);</span><br><span class="line"></span><br><span class="line">    switch (strtolower($position)) &#123;</span><br><span class="line">      case &#x27;phrase&#x27;:</span><br><span class="line">        $encoded = preg_replace(&quot;/([^A-Za-z0-9!*+\/ -])/e&quot;, &quot;&#x27;=&#x27;.sprintf(&#x27;%02X&#x27;, ord(&#x27;\\1&#x27;))&quot;, $encoded);</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;comment&#x27;:</span><br><span class="line">        $encoded = preg_replace(&quot;/([\(\)\&quot;])/e&quot;, &quot;&#x27;=&#x27;.sprintf(&#x27;%02X&#x27;, ord(&#x27;\\1&#x27;))&quot;, $encoded);</span><br><span class="line">      case &#x27;text&#x27;:</span><br><span class="line">      default:</span><br><span class="line">        // Replace every high ascii, control =, ? and _ characters</span><br><span class="line">        //TODO using /e (equivalent to eval()) is probably not a good idea</span><br><span class="line">        $encoded = preg_replace(&#x27;/([\000-\011\013\014\016-\037\075\077\137\177-\377])/e&#x27;,</span><br><span class="line">                                &quot;&#x27;=&#x27;.sprintf(&#x27;%02X&#x27;, ord(stripslashes(&#x27;\\1&#x27;)))&quot;, $encoded);</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Replace every spaces to _ (more readable than =20)</span><br><span class="line">    $encoded = str_replace(&#x27; &#x27;, &#x27;_&#x27;, $encoded);</span><br><span class="line"></span><br><span class="line">    return $encoded;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Adds a string or binary attachment (non-filesystem) to the list.</span><br><span class="line">   * This method can be used to attach ascii or binary data,</span><br><span class="line">   * such as a BLOB record from a database.</span><br><span class="line">   * @param string $string String attachment data.</span><br><span class="line">   * @param string $filename Name of the attachment.</span><br><span class="line">   * @param string $encoding File encoding (see $Encoding).</span><br><span class="line">   * @param string $type File extension (MIME) type.</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function AddStringAttachment($string, $filename, $encoding = &#x27;base64&#x27;, $type = &#x27;application/octet-stream&#x27;) &#123;</span><br><span class="line">    // Append to $attachment array</span><br><span class="line">    $this-&gt;attachment[] = array(</span><br><span class="line">      0 =&gt; $string,</span><br><span class="line">      1 =&gt; $filename,</span><br><span class="line">      2 =&gt; basename($filename),</span><br><span class="line">      3 =&gt; $encoding,</span><br><span class="line">      4 =&gt; $type,</span><br><span class="line">      5 =&gt; true,  // isStringAttachment</span><br><span class="line">      6 =&gt; &#x27;attachment&#x27;,</span><br><span class="line">      7 =&gt; 0</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Adds an embedded attachment.  This can include images, sounds, and</span><br><span class="line">   * just about any other document.  Make sure to set the $type to an</span><br><span class="line">   * image type.  For JPEG images use &quot;image/jpeg&quot; and for GIF images</span><br><span class="line">   * use &quot;image/gif&quot;.</span><br><span class="line">   * @param string $path Path to the attachment.</span><br><span class="line">   * @param string $cid Content ID of the attachment.  Use this to identify</span><br><span class="line">   *        the Id for accessing the image in an HTML form.</span><br><span class="line">   * @param string $name Overrides the attachment name.</span><br><span class="line">   * @param string $encoding File encoding (see $Encoding).</span><br><span class="line">   * @param string $type File extension (MIME) type.</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function AddEmbeddedImage($path, $cid, $name = &#x27;&#x27;, $encoding = &#x27;base64&#x27;, $type = &#x27;application/octet-stream&#x27;) &#123;</span><br><span class="line"></span><br><span class="line">    if ( !@is_file($path) ) &#123;</span><br><span class="line">      $this-&gt;SetError($this-&gt;Lang(&#x27;file_access&#x27;) . $path);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $filename = basename($path);</span><br><span class="line">    if ( $name == &#x27;&#x27; ) &#123;</span><br><span class="line">      $name = $filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Append to $attachment array</span><br><span class="line">    $this-&gt;attachment[] = array(</span><br><span class="line">      0 =&gt; $path,</span><br><span class="line">      1 =&gt; $filename,</span><br><span class="line">      2 =&gt; $name,</span><br><span class="line">      3 =&gt; $encoding,</span><br><span class="line">      4 =&gt; $type,</span><br><span class="line">      5 =&gt; false,  // isStringAttachment</span><br><span class="line">      6 =&gt; &#x27;inline&#x27;,</span><br><span class="line">      7 =&gt; $cid</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public function AddStringEmbeddedImage($string, $cid, $filename = &#x27;&#x27;, $encoding = &#x27;base64&#x27;, $type = &#x27;application/octet-stream&#x27;) &#123;</span><br><span class="line">    // Append to $attachment array</span><br><span class="line">    $this-&gt;attachment[] = array(</span><br><span class="line">      0 =&gt; $string,</span><br><span class="line">      1 =&gt; $filename,</span><br><span class="line">      2 =&gt; basename($filename),</span><br><span class="line">      3 =&gt; $encoding,</span><br><span class="line">      4 =&gt; $type,</span><br><span class="line">      5 =&gt; true,  // isStringAttachment</span><br><span class="line">      6 =&gt; &#x27;inline&#x27;,</span><br><span class="line">      7 =&gt; $cid</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Returns true if an inline attachment is present.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function InlineImageExists() &#123;</span><br><span class="line">    foreach($this-&gt;attachment as $attachment) &#123;</span><br><span class="line">      if ($attachment[6] == &#x27;inline&#x27;) &#123;</span><br><span class="line">        return true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public function AttachmentExists() &#123;</span><br><span class="line">    foreach($this-&gt;attachment as $attachment) &#123;</span><br><span class="line">      if ($attachment[6] == &#x27;attachment&#x27;) &#123;</span><br><span class="line">        return true;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public function AlternativeExists() &#123;</span><br><span class="line">    return strlen($this-&gt;AltBody)&gt;0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // CLASS METHODS, MESSAGE RESET</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Clears all recipients assigned in the TO array.  Returns void.</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function ClearAddresses() &#123;</span><br><span class="line">    foreach($this-&gt;to as $to) &#123;</span><br><span class="line">      unset($this-&gt;all_recipients[strtolower($to[0])]);</span><br><span class="line">    &#125;</span><br><span class="line">    $this-&gt;to = array();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Clears all recipients assigned in the CC array.  Returns void.</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function ClearCCs() &#123;</span><br><span class="line">    foreach($this-&gt;cc as $cc) &#123;</span><br><span class="line">      unset($this-&gt;all_recipients[strtolower($cc[0])]);</span><br><span class="line">    &#125;</span><br><span class="line">    $this-&gt;cc = array();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Clears all recipients assigned in the BCC array.  Returns void.</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function ClearBCCs() &#123;</span><br><span class="line">    foreach($this-&gt;bcc as $bcc) &#123;</span><br><span class="line">      unset($this-&gt;all_recipients[strtolower($bcc[0])]);</span><br><span class="line">    &#125;</span><br><span class="line">    $this-&gt;bcc = array();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Clears all recipients assigned in the ReplyTo array.  Returns void.</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function ClearReplyTos() &#123;</span><br><span class="line">    $this-&gt;ReplyTo = array();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Clears all recipients assigned in the TO, CC and BCC</span><br><span class="line">   * array.  Returns void.</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function ClearAllRecipients() &#123;</span><br><span class="line">    $this-&gt;to = array();</span><br><span class="line">    $this-&gt;cc = array();</span><br><span class="line">    $this-&gt;bcc = array();</span><br><span class="line">    $this-&gt;all_recipients = array();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Clears all previously set filesystem, string, and binary</span><br><span class="line">   * attachments.  Returns void.</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function ClearAttachments() &#123;</span><br><span class="line">    $this-&gt;attachment = array();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Clears all custom headers.  Returns void.</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function ClearCustomHeaders() &#123;</span><br><span class="line">    $this-&gt;CustomHeader = array();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // CLASS METHODS, MISCELLANEOUS</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Adds the error message to the error container.</span><br><span class="line">   * @access protected</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  protected function SetError($msg) &#123;</span><br><span class="line">    $this-&gt;error_count++;</span><br><span class="line">    if ($this-&gt;Mailer == &#x27;smtp&#x27; and !is_null($this-&gt;smtp)) &#123;</span><br><span class="line">      $lasterror = $this-&gt;smtp-&gt;getError();</span><br><span class="line">      if (!empty($lasterror) and array_key_exists(&#x27;smtp_msg&#x27;, $lasterror)) &#123;</span><br><span class="line">        $msg .= &#x27;&lt;p&gt;&#x27; . $this-&gt;Lang(&#x27;smtp_error&#x27;) . $lasterror[&#x27;smtp_msg&#x27;] . &quot;&lt;/p&gt;\n&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $this-&gt;ErrorInfo = $msg;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Returns the proper RFC 822 formatted date.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string</span><br><span class="line">   * @static</span><br><span class="line">   */</span><br><span class="line">  public static function RFCDate() &#123;</span><br><span class="line">    $tz = date(&#x27;Z&#x27;);</span><br><span class="line">    $tzs = ($tz &lt; 0) ? &#x27;-&#x27; : &#x27;+&#x27;;</span><br><span class="line">    $tz = abs($tz);</span><br><span class="line">    $tz = (int)($tz/3600)*100 + ($tz%3600)/60;</span><br><span class="line">    $result = sprintf(&quot;%s %s%04d&quot;, date(&#x27;D, j M Y H:i:s&#x27;), $tzs, $tz);</span><br><span class="line"></span><br><span class="line">    return $result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Returns the server hostname or &#x27;localhost.localdomain&#x27; if unknown.</span><br><span class="line">   * @access protected</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  protected function ServerHostname() &#123;</span><br><span class="line">    if (!empty($this-&gt;Hostname)) &#123;</span><br><span class="line">      $result = $this-&gt;Hostname;</span><br><span class="line">    &#125; elseif (isset($_SERVER[&#x27;SERVER_NAME&#x27;])) &#123;</span><br><span class="line">      $result = $_SERVER[&#x27;SERVER_NAME&#x27;];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      $result = &#x27;localhost.localdomain&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Returns a message in the appropriate language.</span><br><span class="line">   * @access protected</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  protected function Lang($key) &#123;</span><br><span class="line">    if(count($this-&gt;language) &lt; 1) &#123;</span><br><span class="line">      $this-&gt;SetLanguage(&#x27;en&#x27;); // set the default language</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(isset($this-&gt;language[$key])) &#123;</span><br><span class="line">      return $this-&gt;language[$key];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return &#x27;Language string failed to load: &#x27; . $key;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Returns true if an error occurred.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function IsError() &#123;</span><br><span class="line">    return ($this-&gt;error_count &gt; 0);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Changes every end of line from CR or LF to CRLF.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  public function FixEOL($str) &#123;</span><br><span class="line">    $str = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $str);</span><br><span class="line">    $str = str_replace(&quot;\r&quot;, &quot;\n&quot;, $str);</span><br><span class="line">    $str = str_replace(&quot;\n&quot;, $this-&gt;LE, $str);</span><br><span class="line">    return $str;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Adds a custom header.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function AddCustomHeader($custom_header) &#123;</span><br><span class="line">    $this-&gt;CustomHeader[] = explode(&#x27;:&#x27;, $custom_header, 2);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Evaluates the message and returns modifications for inline images and backgrounds</span><br><span class="line">   * @access public</span><br><span class="line">   * @return $message</span><br><span class="line">   */</span><br><span class="line">  public function MsgHTML($message, $basedir = &#x27;&#x27;) &#123;</span><br><span class="line">    preg_match_all(&quot;/(src|background)=[\&quot;&#x27;](.*)[\&quot;&#x27;]/Ui&quot;, $message, $images);</span><br><span class="line">    if(isset($images[2])) &#123;</span><br><span class="line">      foreach($images[2] as $i =&gt; $url) &#123;</span><br><span class="line">        // do not change urls for absolute images (thanks to corvuscorax)</span><br><span class="line">        if (!preg_match(&#x27;#^[A-z]+://#&#x27;, $url)) &#123;</span><br><span class="line">          $filename = basename($url);</span><br><span class="line">          $directory = dirname($url);</span><br><span class="line">          ($directory == &#x27;.&#x27;) ? $directory=&#x27;&#x27;: &#x27;&#x27;;</span><br><span class="line">          $cid = &#x27;cid:&#x27; . md5($filename);</span><br><span class="line">          $ext = pathinfo($filename, PATHINFO_EXTENSION);</span><br><span class="line">          $mimeType  = self::_mime_types($ext);</span><br><span class="line">          if ( strlen($basedir) &gt; 1 &amp;&amp; substr($basedir, -1) != &#x27;/&#x27;) &#123; $basedir .= &#x27;/&#x27;; &#125;</span><br><span class="line">          if ( strlen($directory) &gt; 1 &amp;&amp; substr($directory, -1) != &#x27;/&#x27;) &#123; $directory .= &#x27;/&#x27;; &#125;</span><br><span class="line">          if ( $this-&gt;AddEmbeddedImage($basedir.$directory.$filename, md5($filename), $filename, &#x27;base64&#x27;, $mimeType) ) &#123;</span><br><span class="line">            $message = preg_replace(&quot;/&quot;.$images[1][$i].&quot;=[\&quot;&#x27;]&quot;.preg_quote($url, &#x27;/&#x27;).&quot;[\&quot;&#x27;]/Ui&quot;, $images[1][$i].&quot;=\&quot;&quot;.$cid.&quot;\&quot;&quot;, $message);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $this-&gt;IsHTML(true);</span><br><span class="line">    $this-&gt;Body = $message;</span><br><span class="line">    if (empty($this-&gt;AltBody)) &#123;</span><br><span class="line">        $textMsg = trim(strip_tags(preg_replace(&#x27;/&lt;(head|title|style|script)[^&gt;]*&gt;.*?&lt;\/\\1&gt;/s&#x27;, &#x27;&#x27;, $message)));</span><br><span class="line">        if (!empty($textMsg)) &#123;</span><br><span class="line">            $this-&gt;AltBody = html_entity_decode($textMsg, ENT_QUOTES, $this-&gt;CharSet);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (empty($this-&gt;AltBody)) &#123;</span><br><span class="line">      $this-&gt;AltBody = &#x27;To view this email message, open it in a program that understands HTML!&#x27; . &quot;\n\n&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    return $message;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Gets the MIME type of the embedded or inline image</span><br><span class="line">   * @param string File extension</span><br><span class="line">   * @access public</span><br><span class="line">   * @return string MIME type of ext</span><br><span class="line">   * @static</span><br><span class="line">   */</span><br><span class="line">  public static function _mime_types($ext = &#x27;&#x27;) &#123;</span><br><span class="line">    $mimes = array(</span><br><span class="line">      &#x27;hqx&#x27;   =&gt;  &#x27;application/mac-binhex40&#x27;,</span><br><span class="line">      &#x27;cpt&#x27;   =&gt;  &#x27;application/mac-compactpro&#x27;,</span><br><span class="line">      &#x27;doc&#x27;   =&gt;  &#x27;application/msword&#x27;,</span><br><span class="line">      &#x27;bin&#x27;   =&gt;  &#x27;application/macbinary&#x27;,</span><br><span class="line">      &#x27;dms&#x27;   =&gt;  &#x27;application/octet-stream&#x27;,</span><br><span class="line">      &#x27;lha&#x27;   =&gt;  &#x27;application/octet-stream&#x27;,</span><br><span class="line">      &#x27;lzh&#x27;   =&gt;  &#x27;application/octet-stream&#x27;,</span><br><span class="line">      &#x27;exe&#x27;   =&gt;  &#x27;application/octet-stream&#x27;,</span><br><span class="line">      &#x27;class&#x27; =&gt;  &#x27;application/octet-stream&#x27;,</span><br><span class="line">      &#x27;psd&#x27;   =&gt;  &#x27;application/octet-stream&#x27;,</span><br><span class="line">      &#x27;so&#x27;    =&gt;  &#x27;application/octet-stream&#x27;,</span><br><span class="line">      &#x27;sea&#x27;   =&gt;  &#x27;application/octet-stream&#x27;,</span><br><span class="line">      &#x27;dll&#x27;   =&gt;  &#x27;application/octet-stream&#x27;,</span><br><span class="line">      &#x27;oda&#x27;   =&gt;  &#x27;application/oda&#x27;,</span><br><span class="line">      &#x27;pdf&#x27;   =&gt;  &#x27;application/pdf&#x27;,</span><br><span class="line">      &#x27;ai&#x27;    =&gt;  &#x27;application/postscript&#x27;,</span><br><span class="line">      &#x27;eps&#x27;   =&gt;  &#x27;application/postscript&#x27;,</span><br><span class="line">      &#x27;ps&#x27;    =&gt;  &#x27;application/postscript&#x27;,</span><br><span class="line">      &#x27;smi&#x27;   =&gt;  &#x27;application/smil&#x27;,</span><br><span class="line">      &#x27;smil&#x27;  =&gt;  &#x27;application/smil&#x27;,</span><br><span class="line">      &#x27;mif&#x27;   =&gt;  &#x27;application/vnd.mif&#x27;,</span><br><span class="line">      &#x27;xls&#x27;   =&gt;  &#x27;application/vnd.ms-excel&#x27;,</span><br><span class="line">      &#x27;ppt&#x27;   =&gt;  &#x27;application/vnd.ms-powerpoint&#x27;,</span><br><span class="line">      &#x27;wbxml&#x27; =&gt;  &#x27;application/vnd.wap.wbxml&#x27;,</span><br><span class="line">      &#x27;wmlc&#x27;  =&gt;  &#x27;application/vnd.wap.wmlc&#x27;,</span><br><span class="line">      &#x27;dcr&#x27;   =&gt;  &#x27;application/x-director&#x27;,</span><br><span class="line">      &#x27;dir&#x27;   =&gt;  &#x27;application/x-director&#x27;,</span><br><span class="line">      &#x27;dxr&#x27;   =&gt;  &#x27;application/x-director&#x27;,</span><br><span class="line">      &#x27;dvi&#x27;   =&gt;  &#x27;application/x-dvi&#x27;,</span><br><span class="line">      &#x27;gtar&#x27;  =&gt;  &#x27;application/x-gtar&#x27;,</span><br><span class="line">      &#x27;php&#x27;   =&gt;  &#x27;application/x-httpd-php&#x27;,</span><br><span class="line">      &#x27;php4&#x27;  =&gt;  &#x27;application/x-httpd-php&#x27;,</span><br><span class="line">      &#x27;php3&#x27;  =&gt;  &#x27;application/x-httpd-php&#x27;,</span><br><span class="line">      &#x27;phtml&#x27; =&gt;  &#x27;application/x-httpd-php&#x27;,</span><br><span class="line">      &#x27;phps&#x27;  =&gt;  &#x27;application/x-httpd-php-source&#x27;,</span><br><span class="line">      &#x27;js&#x27;    =&gt;  &#x27;application/x-javascript&#x27;,</span><br><span class="line">      &#x27;swf&#x27;   =&gt;  &#x27;application/x-shockwave-flash&#x27;,</span><br><span class="line">      &#x27;sit&#x27;   =&gt;  &#x27;application/x-stuffit&#x27;,</span><br><span class="line">      &#x27;tar&#x27;   =&gt;  &#x27;application/x-tar&#x27;,</span><br><span class="line">      &#x27;tgz&#x27;   =&gt;  &#x27;application/x-tar&#x27;,</span><br><span class="line">      &#x27;xhtml&#x27; =&gt;  &#x27;application/xhtml+xml&#x27;,</span><br><span class="line">      &#x27;xht&#x27;   =&gt;  &#x27;application/xhtml+xml&#x27;,</span><br><span class="line">      &#x27;zip&#x27;   =&gt;  &#x27;application/zip&#x27;,</span><br><span class="line">      &#x27;mid&#x27;   =&gt;  &#x27;audio/midi&#x27;,</span><br><span class="line">      &#x27;midi&#x27;  =&gt;  &#x27;audio/midi&#x27;,</span><br><span class="line">      &#x27;mpga&#x27;  =&gt;  &#x27;audio/mpeg&#x27;,</span><br><span class="line">      &#x27;mp2&#x27;   =&gt;  &#x27;audio/mpeg&#x27;,</span><br><span class="line">      &#x27;mp3&#x27;   =&gt;  &#x27;audio/mpeg&#x27;,</span><br><span class="line">      &#x27;aif&#x27;   =&gt;  &#x27;audio/x-aiff&#x27;,</span><br><span class="line">      &#x27;aiff&#x27;  =&gt;  &#x27;audio/x-aiff&#x27;,</span><br><span class="line">      &#x27;aifc&#x27;  =&gt;  &#x27;audio/x-aiff&#x27;,</span><br><span class="line">      &#x27;ram&#x27;   =&gt;  &#x27;audio/x-pn-realaudio&#x27;,</span><br><span class="line">      &#x27;rm&#x27;    =&gt;  &#x27;audio/x-pn-realaudio&#x27;,</span><br><span class="line">      &#x27;rpm&#x27;   =&gt;  &#x27;audio/x-pn-realaudio-plugin&#x27;,</span><br><span class="line">      &#x27;ra&#x27;    =&gt;  &#x27;audio/x-realaudio&#x27;,</span><br><span class="line">      &#x27;rv&#x27;    =&gt;  &#x27;video/vnd.rn-realvideo&#x27;,</span><br><span class="line">      &#x27;wav&#x27;   =&gt;  &#x27;audio/x-wav&#x27;,</span><br><span class="line">      &#x27;bmp&#x27;   =&gt;  &#x27;image/bmp&#x27;,</span><br><span class="line">      &#x27;gif&#x27;   =&gt;  &#x27;image/gif&#x27;,</span><br><span class="line">      &#x27;jpeg&#x27;  =&gt;  &#x27;image/jpeg&#x27;,</span><br><span class="line">      &#x27;jpg&#x27;   =&gt;  &#x27;image/jpeg&#x27;,</span><br><span class="line">      &#x27;jpe&#x27;   =&gt;  &#x27;image/jpeg&#x27;,</span><br><span class="line">      &#x27;png&#x27;   =&gt;  &#x27;image/png&#x27;,</span><br><span class="line">      &#x27;tiff&#x27;  =&gt;  &#x27;image/tiff&#x27;,</span><br><span class="line">      &#x27;tif&#x27;   =&gt;  &#x27;image/tiff&#x27;,</span><br><span class="line">      &#x27;css&#x27;   =&gt;  &#x27;text/css&#x27;,</span><br><span class="line">      &#x27;html&#x27;  =&gt;  &#x27;text/html&#x27;,</span><br><span class="line">      &#x27;htm&#x27;   =&gt;  &#x27;text/html&#x27;,</span><br><span class="line">      &#x27;shtml&#x27; =&gt;  &#x27;text/html&#x27;,</span><br><span class="line">      &#x27;txt&#x27;   =&gt;  &#x27;text/plain&#x27;,</span><br><span class="line">      &#x27;text&#x27;  =&gt;  &#x27;text/plain&#x27;,</span><br><span class="line">      &#x27;log&#x27;   =&gt;  &#x27;text/plain&#x27;,</span><br><span class="line">      &#x27;rtx&#x27;   =&gt;  &#x27;text/richtext&#x27;,</span><br><span class="line">      &#x27;rtf&#x27;   =&gt;  &#x27;text/rtf&#x27;,</span><br><span class="line">      &#x27;xml&#x27;   =&gt;  &#x27;text/xml&#x27;,</span><br><span class="line">      &#x27;xsl&#x27;   =&gt;  &#x27;text/xml&#x27;,</span><br><span class="line">      &#x27;mpeg&#x27;  =&gt;  &#x27;video/mpeg&#x27;,</span><br><span class="line">      &#x27;mpg&#x27;   =&gt;  &#x27;video/mpeg&#x27;,</span><br><span class="line">      &#x27;mpe&#x27;   =&gt;  &#x27;video/mpeg&#x27;,</span><br><span class="line">      &#x27;qt&#x27;    =&gt;  &#x27;video/quicktime&#x27;,</span><br><span class="line">      &#x27;mov&#x27;   =&gt;  &#x27;video/quicktime&#x27;,</span><br><span class="line">      &#x27;avi&#x27;   =&gt;  &#x27;video/x-msvideo&#x27;,</span><br><span class="line">      &#x27;movie&#x27; =&gt;  &#x27;video/x-sgi-movie&#x27;,</span><br><span class="line">      &#x27;doc&#x27;   =&gt;  &#x27;application/msword&#x27;,</span><br><span class="line">      &#x27;word&#x27;  =&gt;  &#x27;application/msword&#x27;,</span><br><span class="line">      &#x27;xl&#x27;    =&gt;  &#x27;application/excel&#x27;,</span><br><span class="line">      &#x27;eml&#x27;   =&gt;  &#x27;message/rfc822&#x27;</span><br><span class="line">    );</span><br><span class="line">    return (!isset($mimes[strtolower($ext)])) ? &#x27;application/octet-stream&#x27; : $mimes[strtolower($ext)];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * Set (or reset) Class Objects (variables)</span><br><span class="line">  *</span><br><span class="line">  * Usage Example:</span><br><span class="line">  * $page-&gt;set(&#x27;X-Priority&#x27;, &#x27;3&#x27;);</span><br><span class="line">  *</span><br><span class="line">  * @access public</span><br><span class="line">  * @param string $name Parameter Name</span><br><span class="line">  * @param mixed $value Parameter Value</span><br><span class="line">  * NOTE: will not work with arrays, there are no arrays to set/reset</span><br><span class="line">  * @todo Should this not be using __set() magic function?</span><br><span class="line">  */</span><br><span class="line">  public function set($name, $value = &#x27;&#x27;) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      if (isset($this-&gt;$name) ) &#123;</span><br><span class="line">        $this-&gt;$name = $value;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        throw new phpmailerException($this-&gt;Lang(&#x27;variable_set&#x27;) . $name, self::STOP_CRITICAL);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (Exception $e) &#123;</span><br><span class="line">      $this-&gt;SetError($e-&gt;getMessage());</span><br><span class="line">      if ($e-&gt;getCode() == self::STOP_CRITICAL) &#123;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Strips newlines to prevent header injection.</span><br><span class="line">   * @access public</span><br><span class="line">   * @param string $str String</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  public function SecureHeader($str) &#123;</span><br><span class="line">    $str = str_replace(&quot;\r&quot;, &#x27;&#x27;, $str);</span><br><span class="line">    $str = str_replace(&quot;\n&quot;, &#x27;&#x27;, $str);</span><br><span class="line">    return trim($str);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Set the private key file and password to sign the message.</span><br><span class="line">   *</span><br><span class="line">   * @access public</span><br><span class="line">   * @param string $key_filename Parameter File Name</span><br><span class="line">   * @param string $key_pass Password for private key</span><br><span class="line">   */</span><br><span class="line">  public function Sign($cert_filename, $key_filename, $key_pass) &#123;</span><br><span class="line">    $this-&gt;sign_cert_file = $cert_filename;</span><br><span class="line">    $this-&gt;sign_key_file = $key_filename;</span><br><span class="line">    $this-&gt;sign_key_pass = $key_pass;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Set the private key file and password to sign the message.</span><br><span class="line">   *</span><br><span class="line">   * @access public</span><br><span class="line">   * @param string $key_filename Parameter File Name</span><br><span class="line">   * @param string $key_pass Password for private key</span><br><span class="line">   */</span><br><span class="line">  public function DKIM_QP($txt) &#123;</span><br><span class="line">    $tmp = &#x27;&#x27;;</span><br><span class="line">    $line = &#x27;&#x27;;</span><br><span class="line">    for ($i = 0; $i &lt; strlen($txt); $i++) &#123;</span><br><span class="line">      $ord = ord($txt[$i]);</span><br><span class="line">      if ( ((0x21 &lt;= $ord) &amp;&amp; ($ord &lt;= 0x3A)) || $ord == 0x3C || ((0x3E &lt;= $ord) &amp;&amp; ($ord &lt;= 0x7E)) ) &#123;</span><br><span class="line">        $line .= $txt[$i];</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        $line .= &quot;=&quot;.sprintf(&quot;%02X&quot;, $ord);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return $line;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Generate DKIM signature</span><br><span class="line">   *</span><br><span class="line">   * @access public</span><br><span class="line">   * @param string $s Header</span><br><span class="line">   */</span><br><span class="line">  public function DKIM_Sign($s) &#123;</span><br><span class="line">    $privKeyStr = file_get_contents($this-&gt;DKIM_private);</span><br><span class="line">    if ($this-&gt;DKIM_passphrase != &#x27;&#x27;) &#123;</span><br><span class="line">      $privKey = openssl_pkey_get_private($privKeyStr, $this-&gt;DKIM_passphrase);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      $privKey = $privKeyStr;</span><br><span class="line">    &#125;</span><br><span class="line">    if (openssl_sign($s, $signature, $privKey)) &#123;</span><br><span class="line">      return base64_encode($signature);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Generate DKIM Canonicalization Header</span><br><span class="line">   *</span><br><span class="line">   * @access public</span><br><span class="line">   * @param string $s Header</span><br><span class="line">   */</span><br><span class="line">  public function DKIM_HeaderC($s) &#123;</span><br><span class="line">    $s = preg_replace(&quot;/\r\n\s+/&quot;, &quot; &quot;, $s);</span><br><span class="line">    $lines = explode(&quot;\r\n&quot;, $s);</span><br><span class="line">    foreach ($lines as $key =&gt; $line) &#123;</span><br><span class="line">      list($heading, $value) = explode(&quot;:&quot;, $line, 2);</span><br><span class="line">      $heading = strtolower($heading);</span><br><span class="line">      $value = preg_replace(&quot;/\s+/&quot;, &quot; &quot;, $value) ; // Compress useless spaces</span><br><span class="line">      $lines[$key] = $heading.&quot;:&quot;.trim($value) ; // Don&#x27;t forget to remove WSP around the value</span><br><span class="line">    &#125;</span><br><span class="line">    $s = implode(&quot;\r\n&quot;, $lines);</span><br><span class="line">    return $s;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Generate DKIM Canonicalization Body</span><br><span class="line">   *</span><br><span class="line">   * @access public</span><br><span class="line">   * @param string $body Message Body</span><br><span class="line">   */</span><br><span class="line">  public function DKIM_BodyC($body) &#123;</span><br><span class="line">    if ($body == &#x27;&#x27;) return &quot;\r\n&quot;;</span><br><span class="line">    // stabilize line endings</span><br><span class="line">    $body = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $body);</span><br><span class="line">    $body = str_replace(&quot;\n&quot;, &quot;\r\n&quot;, $body);</span><br><span class="line">    // END stabilize line endings</span><br><span class="line">    while (substr($body, strlen($body) - 4, 4) == &quot;\r\n\r\n&quot;) &#123;</span><br><span class="line">      $body = substr($body, 0, strlen($body) - 2);</span><br><span class="line">    &#125;</span><br><span class="line">    return $body;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Create the DKIM header, body, as new header</span><br><span class="line">   *</span><br><span class="line">   * @access public</span><br><span class="line">   * @param string $headers_line Header lines</span><br><span class="line">   * @param string $subject Subject</span><br><span class="line">   * @param string $body Body</span><br><span class="line">   */</span><br><span class="line">  public function DKIM_Add($headers_line, $subject, $body) &#123;</span><br><span class="line">    $DKIMsignatureType    = &#x27;rsa-sha1&#x27;; // Signature &amp; hash algorithms</span><br><span class="line">    $DKIMcanonicalization = &#x27;relaxed/simple&#x27;; // Canonicalization of header/body</span><br><span class="line">    $DKIMquery            = &#x27;dns/txt&#x27;; // Query method</span><br><span class="line">    $DKIMtime             = time() ; // Signature Timestamp = seconds since 00:00:00 - Jan 1, 1970 (UTC time zone)</span><br><span class="line">    $subject_header       = &quot;Subject: $subject&quot;;</span><br><span class="line">    $headers              = explode($this-&gt;LE, $headers_line);</span><br><span class="line">    foreach($headers as $header) &#123;</span><br><span class="line">      if (strpos($header, &#x27;From:&#x27;) === 0) &#123;</span><br><span class="line">        $from_header = $header;</span><br><span class="line">      &#125; elseif (strpos($header, &#x27;To:&#x27;) === 0) &#123;</span><br><span class="line">        $to_header = $header;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $from     = str_replace(&#x27;|&#x27;, &#x27;=7C&#x27;, $this-&gt;DKIM_QP($from_header));</span><br><span class="line">    $to       = str_replace(&#x27;|&#x27;, &#x27;=7C&#x27;, $this-&gt;DKIM_QP($to_header));</span><br><span class="line">    $subject  = str_replace(&#x27;|&#x27;, &#x27;=7C&#x27;, $this-&gt;DKIM_QP($subject_header)) ; // Copied header fields (dkim-quoted-printable</span><br><span class="line">    $body     = $this-&gt;DKIM_BodyC($body);</span><br><span class="line">    $DKIMlen  = strlen($body) ; // Length of body</span><br><span class="line">    $DKIMb64  = base64_encode(pack(&quot;H*&quot;, sha1($body))) ; // Base64 of packed binary SHA-1 hash of body</span><br><span class="line">    $ident    = ($this-&gt;DKIM_identity == &#x27;&#x27;)? &#x27;&#x27; : &quot; i=&quot; . $this-&gt;DKIM_identity . &quot;;&quot;;</span><br><span class="line">    $dkimhdrs = &quot;DKIM-Signature: v=1; a=&quot; . $DKIMsignatureType . &quot;; q=&quot; . $DKIMquery . &quot;; l=&quot; . $DKIMlen . &quot;; s=&quot; . $this-&gt;DKIM_selector . &quot;;\r\n&quot;.</span><br><span class="line">                &quot;\tt=&quot; . $DKIMtime . &quot;; c=&quot; . $DKIMcanonicalization . &quot;;\r\n&quot;.</span><br><span class="line">                &quot;\th=From:To:Subject;\r\n&quot;.</span><br><span class="line">                &quot;\td=&quot; . $this-&gt;DKIM_domain . &quot;;&quot; . $ident . &quot;\r\n&quot;.</span><br><span class="line">                &quot;\tz=$from\r\n&quot;.</span><br><span class="line">                &quot;\t|$to\r\n&quot;.</span><br><span class="line">                &quot;\t|$subject;\r\n&quot;.</span><br><span class="line">                &quot;\tbh=&quot; . $DKIMb64 . &quot;;\r\n&quot;.</span><br><span class="line">                &quot;\tb=&quot;;</span><br><span class="line">    $toSign   = $this-&gt;DKIM_HeaderC($from_header . &quot;\r\n&quot; . $to_header . &quot;\r\n&quot; . $subject_header . &quot;\r\n&quot; . $dkimhdrs);</span><br><span class="line">    $signed   = $this-&gt;DKIM_Sign($toSign);</span><br><span class="line">    return &quot;X-PHPMAILER-DKIM: phpmailer.worxware.com\r\n&quot;.$dkimhdrs.$signed.&quot;\r\n&quot;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  protected function doCallback($isSent, $to, $cc, $bcc, $subject, $body) &#123;</span><br><span class="line">    if (!empty($this-&gt;action_function) &amp;&amp; function_exists($this-&gt;action_function)) &#123;</span><br><span class="line">      $params = array($isSent, $to, $cc, $bcc, $subject, $body);</span><br><span class="line">      call_user_func_array($this-&gt;action_function, $params);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class phpmailerException extends Exception &#123;</span><br><span class="line">  public function errorMessage() &#123;</span><br><span class="line">    $errorMsg = &#x27;&lt;strong&gt;&#x27; . $this-&gt;getMessage() . &quot;&lt;/strong&gt;&lt;br /&gt;\n&quot;;</span><br><span class="line">    return $errorMsg;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="SMTP文件Smtp-class-php"><a href="#SMTP文件Smtp-class-php" class="headerlink" title="SMTP文件Smtp.class.php"></a>SMTP文件Smtp.class.php</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br></pre></td><td class="code"><pre><span class="line">/*~ class.smtp.php</span><br><span class="line">.---------------------------------------------------------------------------.</span><br><span class="line">|  Software: PHPMailer - PHP email class                                    |</span><br><span class="line">|   Version: 5.2.1                                                          |</span><br><span class="line">|      Site: https://code.google.com/a/apache-extras.org/p/phpmailer/       |</span><br><span class="line">| ------------------------------------------------------------------------- |</span><br><span class="line">|     Admin: Jim Jagielski (project admininistrator)                        |</span><br><span class="line">|   Authors: Andy Prevost (codeworxtech) codeworxtech@users.sourceforge.net |</span><br><span class="line">|          : Marcus Bointon (coolbru) coolbru@users.sourceforge.net         |</span><br><span class="line">|          : Jim Jagielski (jimjag) jimjag@gmail.com                        |</span><br><span class="line">|   Founder: Brent R. Matzelle (original founder)                           |</span><br><span class="line">| Copyright (c) 2010-2012, Jim Jagielski. All Rights Reserved.              |</span><br><span class="line">| Copyright (c) 2004-2009, Andy Prevost. All Rights Reserved.               |</span><br><span class="line">| Copyright (c) 2001-2003, Brent R. Matzelle                                |</span><br><span class="line">| ------------------------------------------------------------------------- |</span><br><span class="line">|   License: Distributed under the Lesser General Public License (LGPL)     |</span><br><span class="line">|            http://www.gnu.org/copyleft/lesser.html                        |</span><br><span class="line">| This program is distributed in the hope that it will be useful - WITHOUT  |</span><br><span class="line">| ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or     |</span><br><span class="line">| FITNESS FOR A PARTICULAR PURPOSE.                                         |</span><br><span class="line">&#x27;---------------------------------------------------------------------------&#x27;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * PHPMailer - PHP SMTP email transport class</span><br><span class="line"> * NOTE: Designed for use with PHP version 5 and up</span><br><span class="line"> * @package PHPMailer</span><br><span class="line"> * @author Andy Prevost</span><br><span class="line"> * @author Marcus Bointon</span><br><span class="line"> * @copyright 2004 - 2008 Andy Prevost</span><br><span class="line"> * @author Jim Jagielski</span><br><span class="line"> * @copyright 2010 - 2012 Jim Jagielski</span><br><span class="line"> * @license http://www.gnu.org/copyleft/lesser.html Distributed under the Lesser General Public License (LGPL)</span><br><span class="line"> * @version $Id: class.smtp.php 450 2010-06-23 16:46:33Z coolbru $</span><br><span class="line"> */</span><br><span class="line">namespace Org\Util;</span><br><span class="line">/**</span><br><span class="line"> * SMTP is rfc 821 compliant and implements all the rfc 821 SMTP</span><br><span class="line"> * commands except TURN which will always return a not implemented</span><br><span class="line"> * error. SMTP also provides some utility methods for sending mail</span><br><span class="line"> * to an SMTP server.</span><br><span class="line"> * original author: Chris Ryan</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">class SMTP &#123;</span><br><span class="line">  /**</span><br><span class="line">   *  SMTP server port</span><br><span class="line">   *  @var int</span><br><span class="line">   */</span><br><span class="line">  public $SMTP_PORT = 25;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   *  SMTP reply line ending</span><br><span class="line">   *  @var string</span><br><span class="line">   */</span><br><span class="line">  public $CRLF = &quot;\r\n&quot;;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   *  Sets whether debugging is turned on</span><br><span class="line">   *  @var bool</span><br><span class="line">   */</span><br><span class="line">  public $do_debug;       // the level of debug to perform</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   *  Sets VERP use on/off (default is off)</span><br><span class="line">   *  @var bool</span><br><span class="line">   */</span><br><span class="line">  public $do_verp = false;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sets the SMTP PHPMailer Version number</span><br><span class="line">   * @var string</span><br><span class="line">   */</span><br><span class="line">  public $Version         = &#x27;5.2.1&#x27;;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // PROPERTIES, PRIVATE AND PROTECTED</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  private $smtp_conn; // the socket to the server</span><br><span class="line">  private $error;     // error if any on the last call</span><br><span class="line">  private $helo_rply; // the reply the server sent to us for HELO</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Initialize the class so that the data is in a known state.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function __construct() &#123;</span><br><span class="line">    $this-&gt;smtp_conn = 0;</span><br><span class="line">    $this-&gt;error = null;</span><br><span class="line">    $this-&gt;helo_rply = null;</span><br><span class="line"></span><br><span class="line">    $this-&gt;do_debug = 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // CONNECTION FUNCTIONS</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Connect to the server specified on the port specified.</span><br><span class="line">   * If the port is not specified use the default SMTP_PORT.</span><br><span class="line">   * If tval is specified then a connection will try and be</span><br><span class="line">   * established with the server for that number of seconds.</span><br><span class="line">   * If tval is not specified the default is 30 seconds to</span><br><span class="line">   * try on the connection.</span><br><span class="line">   *</span><br><span class="line">   * SMTP CODE SUCCESS: 220</span><br><span class="line">   * SMTP CODE FAILURE: 421</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function Connect($host, $port = 0, $tval = 30) &#123;</span><br><span class="line">    // set the error val to null so there is no confusion</span><br><span class="line">    $this-&gt;error = null;</span><br><span class="line"></span><br><span class="line">    // make sure we are __not__ connected</span><br><span class="line">    if($this-&gt;connected()) &#123;</span><br><span class="line">      // already connected, generate error</span><br><span class="line">      $this-&gt;error = array(&quot;error&quot; =&gt; &quot;Already connected to a server&quot;);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(empty($port)) &#123;</span><br><span class="line">      $port = $this-&gt;SMTP_PORT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // connect to the smtp server</span><br><span class="line">    $this-&gt;smtp_conn = @pfsockopen($host,    // the host of the server</span><br><span class="line">                                 $port,    // the port to use</span><br><span class="line">                                 $errno,   // error number if any</span><br><span class="line">                                 $errstr,  // error message if any</span><br><span class="line">                                 $tval);   // give up after ? secs</span><br><span class="line">    // verify we connected properly</span><br><span class="line">    if(empty($this-&gt;smtp_conn)) &#123;</span><br><span class="line">      $this-&gt;error = array(&quot;error&quot; =&gt; &quot;Failed to connect to server&quot;,</span><br><span class="line">                           &quot;errno&quot; =&gt; $errno,</span><br><span class="line">                           &quot;errstr&quot; =&gt; $errstr);</span><br><span class="line">      if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] . &quot;: $errstr ($errno)&quot; . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // SMTP server can take longer to respond, give longer timeout for first read</span><br><span class="line">    // Windows does not have support for this timeout function</span><br><span class="line">    if(substr(PHP_OS, 0, 3) != &quot;WIN&quot;)</span><br><span class="line">     socket_set_timeout($this-&gt;smtp_conn, $tval, 0);</span><br><span class="line"></span><br><span class="line">    // get any announcement</span><br><span class="line">    $announce = $this-&gt;get_lines();</span><br><span class="line"></span><br><span class="line">    if($this-&gt;do_debug &gt;= 2) &#123;</span><br><span class="line">      echo &quot;SMTP -&gt; FROM SERVER:&quot; . $announce . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Initiate a TLS communication with the server.</span><br><span class="line">   *</span><br><span class="line">   * SMTP CODE 220 Ready to start TLS</span><br><span class="line">   * SMTP CODE 501 Syntax error (no parameters allowed)</span><br><span class="line">   * SMTP CODE 454 TLS not available due to temporary reason</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool success</span><br><span class="line">   */</span><br><span class="line">  public function StartTLS() &#123;</span><br><span class="line">    $this-&gt;error = null; # to avoid confusion</span><br><span class="line"></span><br><span class="line">    if(!$this-&gt;connected()) &#123;</span><br><span class="line">      $this-&gt;error = array(&quot;error&quot; =&gt; &quot;Called StartTLS() without being connected&quot;);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fputs($this-&gt;smtp_conn,&quot;STARTTLS&quot; . $this-&gt;CRLF);</span><br><span class="line"></span><br><span class="line">    $rply = $this-&gt;get_lines();</span><br><span class="line">    $code = substr($rply,0,3);</span><br><span class="line"></span><br><span class="line">    if($this-&gt;do_debug &gt;= 2) &#123;</span><br><span class="line">      echo &quot;SMTP -&gt; FROM SERVER:&quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if($code != 220) &#123;</span><br><span class="line">      $this-&gt;error =</span><br><span class="line">         array(&quot;error&quot;     =&gt; &quot;STARTTLS not accepted from server&quot;,</span><br><span class="line">               &quot;smtp_code&quot; =&gt; $code,</span><br><span class="line">               &quot;smtp_msg&quot;  =&gt; substr($rply,4));</span><br><span class="line">      if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] . &quot;: &quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Begin encrypted connection</span><br><span class="line">    if(!stream_socket_enable_crypto($this-&gt;smtp_conn, true, STREAM_CRYPTO_METHOD_TLS_CLIENT)) &#123;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Performs SMTP authentication.  Must be run after running the</span><br><span class="line">   * Hello() method.  Returns true if successfully authenticated.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function Authenticate($username, $password) &#123;</span><br><span class="line">    // Start authentication</span><br><span class="line">    fputs($this-&gt;smtp_conn,&quot;AUTH LOGIN&quot; . $this-&gt;CRLF);</span><br><span class="line"></span><br><span class="line">    $rply = $this-&gt;get_lines();</span><br><span class="line">    $code = substr($rply,0,3);</span><br><span class="line"></span><br><span class="line">    if($code != 334) &#123;</span><br><span class="line">      $this-&gt;error =</span><br><span class="line">        array(&quot;error&quot; =&gt; &quot;AUTH not accepted from server&quot;,</span><br><span class="line">              &quot;smtp_code&quot; =&gt; $code,</span><br><span class="line">              &quot;smtp_msg&quot; =&gt; substr($rply,4));</span><br><span class="line">      if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] . &quot;: &quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Send encoded username</span><br><span class="line">    fputs($this-&gt;smtp_conn, base64_encode($username) . $this-&gt;CRLF);</span><br><span class="line"></span><br><span class="line">    $rply = $this-&gt;get_lines();</span><br><span class="line">    $code = substr($rply,0,3);</span><br><span class="line"></span><br><span class="line">    if($code != 334) &#123;</span><br><span class="line">      $this-&gt;error =</span><br><span class="line">        array(&quot;error&quot; =&gt; &quot;Username not accepted from server&quot;,</span><br><span class="line">              &quot;smtp_code&quot; =&gt; $code,</span><br><span class="line">              &quot;smtp_msg&quot; =&gt; substr($rply,4));</span><br><span class="line">      if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] . &quot;: &quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Send encoded password</span><br><span class="line">    fputs($this-&gt;smtp_conn, base64_encode($password) . $this-&gt;CRLF);</span><br><span class="line"></span><br><span class="line">    $rply = $this-&gt;get_lines();</span><br><span class="line">    $code = substr($rply,0,3);</span><br><span class="line"></span><br><span class="line">    if($code != 235) &#123;</span><br><span class="line">      $this-&gt;error =</span><br><span class="line">        array(&quot;error&quot; =&gt; &quot;Password not accepted from server&quot;,</span><br><span class="line">              &quot;smtp_code&quot; =&gt; $code,</span><br><span class="line">              &quot;smtp_msg&quot; =&gt; substr($rply,4));</span><br><span class="line">      if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] . &quot;: &quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Returns true if connected to a server otherwise false</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function Connected() &#123;</span><br><span class="line">    if(!empty($this-&gt;smtp_conn)) &#123;</span><br><span class="line">      $sock_status = socket_get_status($this-&gt;smtp_conn);</span><br><span class="line">      if($sock_status[&quot;eof&quot;]) &#123;</span><br><span class="line">        // the socket is valid but we are not connected</span><br><span class="line">        if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">            echo &quot;SMTP -&gt; NOTICE:&quot; . $this-&gt;CRLF . &quot;EOF caught while checking if connected&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        $this-&gt;Close();</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      return true; // everything looks good</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Closes the socket and cleans up the state of the class.</span><br><span class="line">   * It is not considered good to use this function without</span><br><span class="line">   * first trying to use QUIT.</span><br><span class="line">   * @access public</span><br><span class="line">   * @return void</span><br><span class="line">   */</span><br><span class="line">  public function Close() &#123;</span><br><span class="line">    $this-&gt;error = null; // so there is no confusion</span><br><span class="line">    $this-&gt;helo_rply = null;</span><br><span class="line">    if(!empty($this-&gt;smtp_conn)) &#123;</span><br><span class="line">      // close the connection and cleanup</span><br><span class="line">      fclose($this-&gt;smtp_conn);</span><br><span class="line">      $this-&gt;smtp_conn = 0;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // SMTP COMMANDS</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Issues a data command and sends the msg_data to the server</span><br><span class="line">   * finializing the mail transaction. $msg_data is the message</span><br><span class="line">   * that is to be send with the headers. Each header needs to be</span><br><span class="line">   * on a single line followed by a &lt;CRLF&gt; with the message headers</span><br><span class="line">   * and the message body being seperated by and additional &lt;CRLF&gt;.</span><br><span class="line">   *</span><br><span class="line">   * Implements rfc 821: DATA &lt;CRLF&gt;</span><br><span class="line">   *</span><br><span class="line">   * SMTP CODE INTERMEDIATE: 354</span><br><span class="line">   *     [data]</span><br><span class="line">   *     &lt;CRLF&gt;.&lt;CRLF&gt;</span><br><span class="line">   *     SMTP CODE SUCCESS: 250</span><br><span class="line">   *     SMTP CODE FAILURE: 552,554,451,452</span><br><span class="line">   * SMTP CODE FAILURE: 451,554</span><br><span class="line">   * SMTP CODE ERROR  : 500,501,503,421</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function Data($msg_data) &#123;</span><br><span class="line">    $this-&gt;error = null; // so no confusion is caused</span><br><span class="line"></span><br><span class="line">    if(!$this-&gt;connected()) &#123;</span><br><span class="line">      $this-&gt;error = array(</span><br><span class="line">              &quot;error&quot; =&gt; &quot;Called Data() without being connected&quot;);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fputs($this-&gt;smtp_conn,&quot;DATA&quot; . $this-&gt;CRLF);</span><br><span class="line"></span><br><span class="line">    $rply = $this-&gt;get_lines();</span><br><span class="line">    $code = substr($rply,0,3);</span><br><span class="line"></span><br><span class="line">    if($this-&gt;do_debug &gt;= 2) &#123;</span><br><span class="line">      echo &quot;SMTP -&gt; FROM SERVER:&quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if($code != 354) &#123;</span><br><span class="line">      $this-&gt;error =</span><br><span class="line">        array(&quot;error&quot; =&gt; &quot;DATA command not accepted from server&quot;,</span><br><span class="line">              &quot;smtp_code&quot; =&gt; $code,</span><br><span class="line">              &quot;smtp_msg&quot; =&gt; substr($rply,4));</span><br><span class="line">      if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] . &quot;: &quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* the server is ready to accept data!</span><br><span class="line">     * according to rfc 821 we should not send more than 1000</span><br><span class="line">     * including the CRLF</span><br><span class="line">     * characters on a single line so we will break the data up</span><br><span class="line">     * into lines by \r and/or \n then if needed we will break</span><br><span class="line">     * each of those into smaller lines to fit within the limit.</span><br><span class="line">     * in addition we will be looking for lines that start with</span><br><span class="line">     * a period &#x27;.&#x27; and append and additional period &#x27;.&#x27; to that</span><br><span class="line">     * line. NOTE: this does not count towards limit.</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    // normalize the line breaks so we know the explode works</span><br><span class="line">    $msg_data = str_replace(&quot;\r\n&quot;,&quot;\n&quot;,$msg_data);</span><br><span class="line">    $msg_data = str_replace(&quot;\r&quot;,&quot;\n&quot;,$msg_data);</span><br><span class="line">    $lines = explode(&quot;\n&quot;,$msg_data);</span><br><span class="line"></span><br><span class="line">    /* we need to find a good way to determine is headers are</span><br><span class="line">     * in the msg_data or if it is a straight msg body</span><br><span class="line">     * currently I am assuming rfc 822 definitions of msg headers</span><br><span class="line">     * and if the first field of the first line (&#x27;:&#x27; sperated)</span><br><span class="line">     * does not contain a space then it _should_ be a header</span><br><span class="line">     * and we can process all lines before a blank &quot;&quot; line as</span><br><span class="line">     * headers.</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    $field = substr($lines[0],0,strpos($lines[0],&quot;:&quot;));</span><br><span class="line">    $in_headers = false;</span><br><span class="line">    if(!empty($field) &amp;&amp; !strstr($field,&quot; &quot;)) &#123;</span><br><span class="line">      $in_headers = true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $max_line_length = 998; // used below; set here for ease in change</span><br><span class="line"></span><br><span class="line">    while(list(,$line) = @each($lines)) &#123;</span><br><span class="line">      $lines_out = null;</span><br><span class="line">      if($line == &quot;&quot; &amp;&amp; $in_headers) &#123;</span><br><span class="line">        $in_headers = false;</span><br><span class="line">      &#125;</span><br><span class="line">      // ok we need to break this line up into several smaller lines</span><br><span class="line">      while(strlen($line) &gt; $max_line_length) &#123;</span><br><span class="line">        $pos = strrpos(substr($line,0,$max_line_length),&quot; &quot;);</span><br><span class="line"></span><br><span class="line">        // Patch to fix DOS attack</span><br><span class="line">        if(!$pos) &#123;</span><br><span class="line">          $pos = $max_line_length - 1;</span><br><span class="line">          $lines_out[] = substr($line,0,$pos);</span><br><span class="line">          $line = substr($line,$pos);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          $lines_out[] = substr($line,0,$pos);</span><br><span class="line">          $line = substr($line,$pos + 1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* if processing headers add a LWSP-char to the front of new line</span><br><span class="line">         * rfc 822 on long msg headers</span><br><span class="line">         */</span><br><span class="line">        if($in_headers) &#123;</span><br><span class="line">          $line = &quot;\t&quot; . $line;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      $lines_out[] = $line;</span><br><span class="line"></span><br><span class="line">      // send the lines to the server</span><br><span class="line">      while(list(,$line_out) = @each($lines_out)) &#123;</span><br><span class="line">        if(strlen($line_out) &gt; 0)</span><br><span class="line">        &#123;</span><br><span class="line">          if(substr($line_out, 0, 1) == &quot;.&quot;) &#123;</span><br><span class="line">            $line_out = &quot;.&quot; . $line_out;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        fputs($this-&gt;smtp_conn,$line_out . $this-&gt;CRLF);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // message data has been sent</span><br><span class="line">    fputs($this-&gt;smtp_conn, $this-&gt;CRLF . &quot;.&quot; . $this-&gt;CRLF);</span><br><span class="line"></span><br><span class="line">    $rply = $this-&gt;get_lines();</span><br><span class="line">    $code = substr($rply,0,3);</span><br><span class="line"></span><br><span class="line">    if($this-&gt;do_debug &gt;= 2) &#123;</span><br><span class="line">      echo &quot;SMTP -&gt; FROM SERVER:&quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if($code != 250) &#123;</span><br><span class="line">      $this-&gt;error =</span><br><span class="line">        array(&quot;error&quot; =&gt; &quot;DATA not accepted from server&quot;,</span><br><span class="line">              &quot;smtp_code&quot; =&gt; $code,</span><br><span class="line">              &quot;smtp_msg&quot; =&gt; substr($rply,4));</span><br><span class="line">      if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] . &quot;: &quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sends the HELO command to the smtp server.</span><br><span class="line">   * This makes sure that we and the server are in</span><br><span class="line">   * the same known state.</span><br><span class="line">   *</span><br><span class="line">   * Implements from rfc 821: HELO &lt;SP&gt; &lt;domain&gt; &lt;CRLF&gt;</span><br><span class="line">   *</span><br><span class="line">   * SMTP CODE SUCCESS: 250</span><br><span class="line">   * SMTP CODE ERROR  : 500, 501, 504, 421</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function Hello($host = &#x27;&#x27;) &#123;</span><br><span class="line">    $this-&gt;error = null; // so no confusion is caused</span><br><span class="line"></span><br><span class="line">    if(!$this-&gt;connected()) &#123;</span><br><span class="line">      $this-&gt;error = array(</span><br><span class="line">            &quot;error&quot; =&gt; &quot;Called Hello() without being connected&quot;);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // if hostname for HELO was not specified send default</span><br><span class="line">    if(empty($host)) &#123;</span><br><span class="line">      // determine appropriate default to send to server</span><br><span class="line">      $host = &quot;localhost&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Send extended hello first (RFC 2821)</span><br><span class="line">    if(!$this-&gt;SendHello(&quot;EHLO&quot;, $host)) &#123;</span><br><span class="line">      if(!$this-&gt;SendHello(&quot;HELO&quot;, $host)) &#123;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sends a HELO/EHLO command.</span><br><span class="line">   * @access private</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  private function SendHello($hello, $host) &#123;</span><br><span class="line">    fputs($this-&gt;smtp_conn, $hello . &quot; &quot; . $host . $this-&gt;CRLF);</span><br><span class="line"></span><br><span class="line">    $rply = $this-&gt;get_lines();</span><br><span class="line">    $code = substr($rply,0,3);</span><br><span class="line"></span><br><span class="line">    if($this-&gt;do_debug &gt;= 2) &#123;</span><br><span class="line">      echo &quot;SMTP -&gt; FROM SERVER: &quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if($code != 250) &#123;</span><br><span class="line">      $this-&gt;error =</span><br><span class="line">        array(&quot;error&quot; =&gt; $hello . &quot; not accepted from server&quot;,</span><br><span class="line">              &quot;smtp_code&quot; =&gt; $code,</span><br><span class="line">              &quot;smtp_msg&quot; =&gt; substr($rply,4));</span><br><span class="line">      if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] . &quot;: &quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $this-&gt;helo_rply = $rply;</span><br><span class="line"></span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Starts a mail transaction from the email address specified in</span><br><span class="line">   * $from. Returns true if successful or false otherwise. If True</span><br><span class="line">   * the mail transaction is started and then one or more Recipient</span><br><span class="line">   * commands may be called followed by a Data command.</span><br><span class="line">   *</span><br><span class="line">   * Implements rfc 821: MAIL &lt;SP&gt; FROM:&lt;reverse-path&gt; &lt;CRLF&gt;</span><br><span class="line">   *</span><br><span class="line">   * SMTP CODE SUCCESS: 250</span><br><span class="line">   * SMTP CODE SUCCESS: 552,451,452</span><br><span class="line">   * SMTP CODE SUCCESS: 500,501,421</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function Mail($from) &#123;</span><br><span class="line">    $this-&gt;error = null; // so no confusion is caused</span><br><span class="line"></span><br><span class="line">    if(!$this-&gt;connected()) &#123;</span><br><span class="line">      $this-&gt;error = array(</span><br><span class="line">              &quot;error&quot; =&gt; &quot;Called Mail() without being connected&quot;);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $useVerp = ($this-&gt;do_verp ? &quot;XVERP&quot; : &quot;&quot;);</span><br><span class="line">    fputs($this-&gt;smtp_conn,&quot;MAIL FROM:&lt;&quot; . $from . &quot;&gt;&quot; . $useVerp . $this-&gt;CRLF);</span><br><span class="line"></span><br><span class="line">    $rply = $this-&gt;get_lines();</span><br><span class="line">    $code = substr($rply,0,3);</span><br><span class="line"></span><br><span class="line">    if($this-&gt;do_debug &gt;= 2) &#123;</span><br><span class="line">      echo &quot;SMTP -&gt; FROM SERVER:&quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if($code != 250) &#123;</span><br><span class="line">      $this-&gt;error =</span><br><span class="line">        array(&quot;error&quot; =&gt; &quot;MAIL not accepted from server&quot;,</span><br><span class="line">              &quot;smtp_code&quot; =&gt; $code,</span><br><span class="line">              &quot;smtp_msg&quot; =&gt; substr($rply,4));</span><br><span class="line">      if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] . &quot;: &quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sends the quit command to the server and then closes the socket</span><br><span class="line">   * if there is no error or the $close_on_error argument is true.</span><br><span class="line">   *</span><br><span class="line">   * Implements from rfc 821: QUIT &lt;CRLF&gt;</span><br><span class="line">   *</span><br><span class="line">   * SMTP CODE SUCCESS: 221</span><br><span class="line">   * SMTP CODE ERROR  : 500</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function Quit($close_on_error = true) &#123;</span><br><span class="line">    $this-&gt;error = null; // so there is no confusion</span><br><span class="line"></span><br><span class="line">    if(!$this-&gt;connected()) &#123;</span><br><span class="line">      $this-&gt;error = array(</span><br><span class="line">              &quot;error&quot; =&gt; &quot;Called Quit() without being connected&quot;);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // send the quit command to the server</span><br><span class="line">    fputs($this-&gt;smtp_conn,&quot;quit&quot; . $this-&gt;CRLF);</span><br><span class="line"></span><br><span class="line">    // get any good-bye messages</span><br><span class="line">    $byemsg = $this-&gt;get_lines();</span><br><span class="line"></span><br><span class="line">    if($this-&gt;do_debug &gt;= 2) &#123;</span><br><span class="line">      echo &quot;SMTP -&gt; FROM SERVER:&quot; . $byemsg . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $rval = true;</span><br><span class="line">    $e = null;</span><br><span class="line"></span><br><span class="line">    $code = substr($byemsg,0,3);</span><br><span class="line">    if($code != 221) &#123;</span><br><span class="line">      // use e as a tmp var cause Close will overwrite $this-&gt;error</span><br><span class="line">      $e = array(&quot;error&quot; =&gt; &quot;SMTP server rejected quit command&quot;,</span><br><span class="line">                 &quot;smtp_code&quot; =&gt; $code,</span><br><span class="line">                 &quot;smtp_rply&quot; =&gt; substr($byemsg,4));</span><br><span class="line">      $rval = false;</span><br><span class="line">      if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; ERROR: &quot; . $e[&quot;error&quot;] . &quot;: &quot; . $byemsg . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(empty($e) || $close_on_error) &#123;</span><br><span class="line">      $this-&gt;Close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $rval;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sends the command RCPT to the SMTP server with the TO: argument of $to.</span><br><span class="line">   * Returns true if the recipient was accepted false if it was rejected.</span><br><span class="line">   *</span><br><span class="line">   * Implements from rfc 821: RCPT &lt;SP&gt; TO:&lt;forward-path&gt; &lt;CRLF&gt;</span><br><span class="line">   *</span><br><span class="line">   * SMTP CODE SUCCESS: 250,251</span><br><span class="line">   * SMTP CODE FAILURE: 550,551,552,553,450,451,452</span><br><span class="line">   * SMTP CODE ERROR  : 500,501,503,421</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function Recipient($to) &#123;</span><br><span class="line">    $this-&gt;error = null; // so no confusion is caused</span><br><span class="line"></span><br><span class="line">    if(!$this-&gt;connected()) &#123;</span><br><span class="line">      $this-&gt;error = array(</span><br><span class="line">              &quot;error&quot; =&gt; &quot;Called Recipient() without being connected&quot;);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fputs($this-&gt;smtp_conn,&quot;RCPT TO:&lt;&quot; . $to . &quot;&gt;&quot; . $this-&gt;CRLF);</span><br><span class="line"></span><br><span class="line">    $rply = $this-&gt;get_lines();</span><br><span class="line">    $code = substr($rply,0,3);</span><br><span class="line"></span><br><span class="line">    if($this-&gt;do_debug &gt;= 2) &#123;</span><br><span class="line">      echo &quot;SMTP -&gt; FROM SERVER:&quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if($code != 250 &amp;&amp; $code != 251) &#123;</span><br><span class="line">      $this-&gt;error =</span><br><span class="line">        array(&quot;error&quot; =&gt; &quot;RCPT not accepted from server&quot;,</span><br><span class="line">              &quot;smtp_code&quot; =&gt; $code,</span><br><span class="line">              &quot;smtp_msg&quot; =&gt; substr($rply,4));</span><br><span class="line">      if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] . &quot;: &quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Sends the RSET command to abort and transaction that is</span><br><span class="line">   * currently in progress. Returns true if successful false</span><br><span class="line">   * otherwise.</span><br><span class="line">   *</span><br><span class="line">   * Implements rfc 821: RSET &lt;CRLF&gt;</span><br><span class="line">   *</span><br><span class="line">   * SMTP CODE SUCCESS: 250</span><br><span class="line">   * SMTP CODE ERROR  : 500,501,504,421</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function Reset() &#123;</span><br><span class="line">    $this-&gt;error = null; // so no confusion is caused</span><br><span class="line"></span><br><span class="line">    if(!$this-&gt;connected()) &#123;</span><br><span class="line">      $this-&gt;error = array(</span><br><span class="line">              &quot;error&quot; =&gt; &quot;Called Reset() without being connected&quot;);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fputs($this-&gt;smtp_conn,&quot;RSET&quot; . $this-&gt;CRLF);</span><br><span class="line"></span><br><span class="line">    $rply = $this-&gt;get_lines();</span><br><span class="line">    $code = substr($rply,0,3);</span><br><span class="line"></span><br><span class="line">    if($this-&gt;do_debug &gt;= 2) &#123;</span><br><span class="line">      echo &quot;SMTP -&gt; FROM SERVER:&quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if($code != 250) &#123;</span><br><span class="line">      $this-&gt;error =</span><br><span class="line">        array(&quot;error&quot; =&gt; &quot;RSET failed&quot;,</span><br><span class="line">              &quot;smtp_code&quot; =&gt; $code,</span><br><span class="line">              &quot;smtp_msg&quot; =&gt; substr($rply,4));</span><br><span class="line">      if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] . &quot;: &quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Starts a mail transaction from the email address specified in</span><br><span class="line">   * $from. Returns true if successful or false otherwise. If True</span><br><span class="line">   * the mail transaction is started and then one or more Recipient</span><br><span class="line">   * commands may be called followed by a Data command. This command</span><br><span class="line">   * will send the message to the users terminal if they are logged</span><br><span class="line">   * in and send them an email.</span><br><span class="line">   *</span><br><span class="line">   * Implements rfc 821: SAML &lt;SP&gt; FROM:&lt;reverse-path&gt; &lt;CRLF&gt;</span><br><span class="line">   *</span><br><span class="line">   * SMTP CODE SUCCESS: 250</span><br><span class="line">   * SMTP CODE SUCCESS: 552,451,452</span><br><span class="line">   * SMTP CODE SUCCESS: 500,501,502,421</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function SendAndMail($from) &#123;</span><br><span class="line">    $this-&gt;error = null; // so no confusion is caused</span><br><span class="line"></span><br><span class="line">    if(!$this-&gt;connected()) &#123;</span><br><span class="line">      $this-&gt;error = array(</span><br><span class="line">          &quot;error&quot; =&gt; &quot;Called SendAndMail() without being connected&quot;);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fputs($this-&gt;smtp_conn,&quot;SAML FROM:&quot; . $from . $this-&gt;CRLF);</span><br><span class="line"></span><br><span class="line">    $rply = $this-&gt;get_lines();</span><br><span class="line">    $code = substr($rply,0,3);</span><br><span class="line"></span><br><span class="line">    if($this-&gt;do_debug &gt;= 2) &#123;</span><br><span class="line">      echo &quot;SMTP -&gt; FROM SERVER:&quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if($code != 250) &#123;</span><br><span class="line">      $this-&gt;error =</span><br><span class="line">        array(&quot;error&quot; =&gt; &quot;SAML not accepted from server&quot;,</span><br><span class="line">              &quot;smtp_code&quot; =&gt; $code,</span><br><span class="line">              &quot;smtp_msg&quot; =&gt; substr($rply,4));</span><br><span class="line">      if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; ERROR: &quot; . $this-&gt;error[&quot;error&quot;] . &quot;: &quot; . $rply . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * This is an optional command for SMTP that this class does not</span><br><span class="line">   * support. This method is here to make the RFC821 Definition</span><br><span class="line">   * complete for this class and __may__ be implimented in the future</span><br><span class="line">   *</span><br><span class="line">   * Implements from rfc 821: TURN &lt;CRLF&gt;</span><br><span class="line">   *</span><br><span class="line">   * SMTP CODE SUCCESS: 250</span><br><span class="line">   * SMTP CODE FAILURE: 502</span><br><span class="line">   * SMTP CODE ERROR  : 500, 503</span><br><span class="line">   * @access public</span><br><span class="line">   * @return bool</span><br><span class="line">   */</span><br><span class="line">  public function Turn() &#123;</span><br><span class="line">    $this-&gt;error = array(&quot;error&quot; =&gt; &quot;This method, TURN, of the SMTP &quot;.</span><br><span class="line">                                    &quot;is not implemented&quot;);</span><br><span class="line">    if($this-&gt;do_debug &gt;= 1) &#123;</span><br><span class="line">      echo &quot;SMTP -&gt; NOTICE: &quot; . $this-&gt;error[&quot;error&quot;] . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * Get the current error</span><br><span class="line">  * @access public</span><br><span class="line">  * @return array</span><br><span class="line">  */</span><br><span class="line">  public function getError() &#123;</span><br><span class="line">    return $this-&gt;error;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line">  // INTERNAL FUNCTIONS</span><br><span class="line">  /////////////////////////////////////////////////</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Read in as many lines as possible</span><br><span class="line">   * either before eof or socket timeout occurs on the operation.</span><br><span class="line">   * With SMTP we can tell if we have more lines to read if the</span><br><span class="line">   * 4th character is &#x27;-&#x27; symbol. If it is a space then we don&#x27;t</span><br><span class="line">   * need to read anything else.</span><br><span class="line">   * @access private</span><br><span class="line">   * @return string</span><br><span class="line">   */</span><br><span class="line">  private function get_lines() &#123;</span><br><span class="line">    $data = &quot;&quot;;</span><br><span class="line">    while(!feof($this-&gt;smtp_conn)) &#123;</span><br><span class="line">      $str = @fgets($this-&gt;smtp_conn,515);</span><br><span class="line">      if($this-&gt;do_debug &gt;= 4) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; get_lines(): \$data was \&quot;$data\&quot;&quot; . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">        echo &quot;SMTP -&gt; get_lines(): \$str is \&quot;$str\&quot;&quot; . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      $data .= $str;</span><br><span class="line">      if($this-&gt;do_debug &gt;= 4) &#123;</span><br><span class="line">        echo &quot;SMTP -&gt; get_lines(): \$data is \&quot;$data\&quot;&quot; . $this-&gt;CRLF . &#x27;&lt;br /&gt;&#x27;;</span><br><span class="line">      &#125;</span><br><span class="line">      // if 4th character is a space, we are done reading, break the loop</span><br><span class="line">      if(substr($str,3,1) == &quot; &quot;) &#123; break; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return $data;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="异常类Exception-class-php"><a href="#异常类Exception-class-php" class="headerlink" title="异常类Exception.class.php"></a>异常类Exception.class.php</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// +----------------------------------------------------------------------</span><br><span class="line">// | ThinkPHP [ WE CAN DO IT JUST THINK IT ]</span><br><span class="line">// +----------------------------------------------------------------------</span><br><span class="line">// | Copyright (c) 2006-2014 http://thinkphp.cn All rights reserved.</span><br><span class="line">// +----------------------------------------------------------------------</span><br><span class="line">// | Licensed ( http://www.apache.org/licenses/LICENSE-2.0 )</span><br><span class="line">// +----------------------------------------------------------------------</span><br><span class="line">// | Author: liu21st &lt;liu21st@gmail.com&gt;</span><br><span class="line">// +----------------------------------------------------------------------</span><br><span class="line">namespace Think;</span><br><span class="line">/**</span><br><span class="line"> * ThinkPHP系统异常基类</span><br><span class="line"> */</span><br><span class="line">class Exception extends \Exception &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">pengweifu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.pengwf.com/2015/12/04/web/PHP-Send-Mail-With-PHPMailer/">https://www.pengwf.com/2015/12/04/web/PHP-Send-Mail-With-PHPMailer/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.pengwf.com" target="_blank">麦子的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/mail/">mail</a></div><div class="post_share"><div class="social-share" data-image="https://www.pengwf.com/images/mac/10.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/images/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/images/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2015/12/04/web/ASP-Send-Mail-With-Jmail/"><img class="prev-cover" src="https://www.pengwf.com/images/mac/10.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ASP使用Jmail组件发送邮件</div></div></a></div><div class="next-post pull-right"><a href="/2015/10/14/web/PHP-PHPUNIT-Demo/"><img class="next-cover" src="https://www.pengwf.com/images/mac/10.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Windows下PHPunit安装及入门演示</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2015/12/04/web/ASP-Send-Mail-With-Jmail/" title="ASP使用Jmail组件发送邮件"><img class="cover" src="https://www.pengwf.com/images/mac/10.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2015-12-04</div><div class="title">ASP使用Jmail组件发送邮件</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></div><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2011 - 2025 By pengweifu</div><div class="footer_custom_text">Powered by Hexo</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="/js/search/local-search.js"></script><script>function loadValine () {
  function initValine () {
    const initData = {
      el: '#vcomment',
      appId: 'GhhAA0g4gw9mRpiEtPJPzflW-MdYXbMMI',
      appKey: 'zoVfkgXT2AASP1dzJEEAUxEI',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: 'https://blog.pengwf.com',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }

    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.bootcdn.net/ajax/libs/valine/1.5.1/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.bootcdn.net/ajax/libs/butterfly-extsrc/1.1.3/canvas-fluttering-ribbon.min.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?dacd8ad9b164966db78ec428d192d58c"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":150,"height":300,"hOffset":40},"mobile":{"show":false},"react":{"opacity":1},"log":false});</script></body></html>